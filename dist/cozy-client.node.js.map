{"version":3,"sources":["webpack:///webpack/bootstrap b98d5cb102a0e4a75f24","webpack:///./src/fetch.js","webpack:///./src/utils.js","webpack:///./src/doctypes.js","webpack:///./src/auth_v3.js","webpack:///external \"babel-runtime/regenerator\"","webpack:///./src/intents/helpers.js","webpack:///external \"isomorphic-fetch\"","webpack:///external \"btoa\"","webpack:///./src/jsonapi.js","webpack:///./src/intents/index.js","webpack:///./src/index.js","webpack:///external \"core-js/modules/es6.object.assign\"","webpack:///./src/auth_storage.js","webpack:///./src/auth_v2.js","webpack:///external \"crypto\"","webpack:///./src/data.js","webpack:///./src/mango.js","webpack:///./src/files.js","webpack:///./src/intents/client.js","webpack:///./src/intents/service.js","webpack:///./src/jobs.js","webpack:///./src/offline.js","webpack:///external \"pouchdb-browser\"","webpack:///external \"pouchdb-find\"","webpack:///./src/settings.js","webpack:///./src/relations.js"],"names":["cozyFetch","cozyFetchJSON","cozyFetchRawJSON","handleInvalidTokenError","cozy","path","options","fullpath","then","resp","disableAuth","fetch","manualAuthCredentials","cozyFetchWithAuth","authorize","credentials","handleResponse","res","_invalidTokenErrorHandler","headers","token","toAuthHeader","Promise","all","isV2","status","dontRetry","client","AccessToken","saveCredentials","newToken","method","body","processJSONAPI","fetchJSON","handleJSONResponse","response","undefined","JSON","stringify","invalidTokenErrorHandler","ok","data","contentType","get","indexOf","json","text","error","FetchError","err","isInvalidToken","Error","jsonapi","currentOrigin","window","location","origin","requestUrl","url","replace","redirectURL","disconnect","e","console","warn","reason","captureStackTrace","constructor","name","Object","defineProperty","value","message","isUnauthorized","isNotFound","unpromiser","isPromise","isOnline","isOffline","sleep","retry","getFuzzedDelay","getBackedoffDelay","createPath","encodeQuery","decodeQuery","FuzzFactor","fn","args","apply","l","length","cb","navigator","onLine","time","setTimeout","resolve","count","delay","doTry","catch","retryDelay","fuzzingFactor","Math","random","retryCount","pow","doctype","id","query","route","encodeURIComponent","q","qname","queryIndex","queries","fragIndex","queryStr","slice","parts","split","i","pair","decodeURIComponent","hasOwnProperty","warned","push","normalizeDoctype","DOCTYPE_FILES","KNOWN_DOCTYPES","files","folder","contact","event","track","playlist","REVERSE_KNOWN","keys","forEach","k","isQualified","known","registerClient","updateClient","unregisterClient","getClient","getAuthCodeURL","getAccessToken","refreshToken","oauthFlow","StateSize","CredsKey","StateKey","Client","opts","clientID","client_id","clientSecret","client_secret","registrationAccessToken","registration_access_token","redirect_uris","redirectURI","softwareID","software_id","softwareVersion","software_version","clientName","client_name","clientKind","client_kind","clientURI","client_uri","logoURI","logo_uri","policyURI","policy_uri","notificationPlatform","notification_platform","notificationDeviceToken","notification_device_token","tokenType","token_type","accessToken","access_token","refresh_token","scope","AppToken","clientParams","_clientParams","cli","isRegistered","reject","toRegisterJSON","resetSecret","createClient","oldClient","newClient","shouldPassRegistration","scopes","state","generateRandomState","redirect_uri","response_type","join","_url","pageURL","grantQueries","getGrantCodeFromPageURL","retrieveToken","grant_type","code","storage","onRegistered","ignoreCachedCredentials","clear","tryCount","clearAndRetry","registerNewClient","save","load","storedState","statePromise","t","delete","creds","assign","href","buffer","crypto","getRandomValues","Uint8Array","require","randomBytes","Array","floor","btoa","String","fromCharCode","pickService","errorSerializer","mapErrorProperties","from","to","result","nativeProperties","reduce","property","serialize","deserialize","first","arr","intent","filterServices","services","attributes","filteredServices","filter","indexKey","doc","type","findByRef","resources","ref","handleResource","rawResource","links","resource","_id","_type","_rev","meta","rev","relations","rels","relationships","isArray","map","handleTopLevel","included","r","create","service","baseURL","removeQueryString","buildRedirectionURL","getRedirectionURL","redirectFn","redirectionURL","redirect","createService","action","permissions","createPromise","start","element","onReadyCallback","intentId","serviceWindow","isSerializable","includes","parameterStrings","key","auth","mango","intents","jobs","offline","settings","AppTokenV3","AccessTokenV3","ClientV3","AuthNone","AuthRunning","AuthError","AuthOK","defaultClientParams","dataProto","find","findMany","findAll","update","_delete","updateAttributes","changesFeed","defineIndex","addReferencedFiles","removeReferencedFiles","listReferencedFiles","fetchReferencedFiles","destroy","authProto","filesProto","createDirectory","createDirectoryByPath","updateById","updateAttributesById","updateAttributesByPath","trashById","statById","statByPath","downloadById","downloadByPath","getDownloadLinkById","getDownloadLink","getDownloadLinkByPath","getArchiveLink","getArchiveLinkByPaths","getArchiveLinkByIds","getFilePath","getCollectionShareLink","queryFiles","listTrash","clearTrash","restoreById","destroyById","intentsProto","jobsProto","queued","offlineProto","init","getDoctypes","hasDatabase","getDatabase","createDatabase","migrateDatabase","destroyDatabase","destroyAllDatabase","hasReplication","replicateFromCozy","stopReplication","stopAllReplication","hasRepeatedReplication","startRepeatedReplication","stopRepeatedReplication","stopAllRepeatedReplication","settingsProto","diskUsage","changePassphrase","getInstance","updateInstance","getClients","deleteClientById","updateLastSync","ensureHasReconnectParam","URL","searchParams","has","append","search","toString","AppTokenV2","LocalStorage","MemoryStorage","_inited","_oauth","_token","_authstate","_authcreds","_storage","_version","version","_offline","oauth","_onRegistered","nopOnRegistered","cozyURL","onInvalidTokenError","disablePromises","addToProto","_fetch","_fetchJSON","concat","prototype","call","arguments","forceTokenRefresh","pathprefix","datasystem","protoify","context","prototyped","ctx","obj","proto","attr","module","exports","prefix","localStorage","setItem","item","getItem","parse","removeItem","hash","deleted","getAppToken","V2TOKEN_ABORT_TIMEOUT","parent","postMessage","timeout","receiver","appName","removeEventListener","clearTimeout","addEventListener","NOREV","docType","httpVerb","ids","include_docs","docs","rows","row","match","changes","tries","parseSelector","normalizeSelector","makeMapReduceQuery","fields","defineIndexV2","defineIndexV3","indexRef","queryV2","queryV3","getV3Options","wholeResponse","VALUEOPERATORS","LOGICOPERATORS","MAP_TEMPLATE","toLowerCase","emit","FIELDSPLACEHOLDER","COUCHDB_INFINITY","COUCHDB_LOWEST","indexName","capitalize","indexDefinition","makeMapFunction","index","indexResult","selector","$gt","use_index","limit","skip","since","sort","descending","f","charAt","toUpperCase","operator","acc","filters","op","field","applySelector","lower","upper","inclusiveEnd","startkey","endkey","inclusive_end","mrquery","firstFreeValueField","normalizedSelector","used","isFreeValue","ArrayBuffer","isBuffer","isFile","File","isBlob","Blob","isStream","readable","pipe","isString","contentLength","checksum","lastModifiedDate","ifMatch","metadata","sourceAccount","sourceAccountIdentifier","contentTypeOctetStream","getFileTypeFromName","Date","toGMTString","finalpath","sendMetadata","metadataId","addQuerystringParam","doUpload","ROOT_DIR_ID","TRASH_DIR_ID","sanitizeFileName","trim","test","dirID","executable","noSanitize","getDirectoryOrCreate","parentDirectory","parsedError","errors","part","rootDirectoryPromise","parentDirectoryPromise","doUpdateAttributes","attrs","db","dir_id","children","sortFiles","addIsDir","toJsonApi","encodePageOptions","extractResponseLinkRelated","related","file","folderPath","endsWith","collectionType","verbs","values","collection","sharecode","codes","email","paths","archive","isDir","contents","clone","allFiles","folders","a","b","localeCompare","intentClass","hideIntentIframe","iframe","style","display","showIntentFrame","buildIntentIframe","document","ownerDocument","createElement","setAttribute","classList","add","injectIntentIframe","onload","appendChild","focus","connectIntentIframe","exposeIntentFrameRemoval","compose","defaultView","serviceOrigin","src","handshaken","messageHandler","eventType","source","transition","dimensions","prop","removeIntentFrame","parentNode","removeChild","listenClientData","messageEventListener","maximize","height","documentElement","terminated","sendMessage","composeEventListener","terminate","resizeClient","transitionProperty","maxHeight","clientHeight","maxWidth","clientWidth","cancel","getData","getIntent","eventName","throw","workerType","setDatabase","replicationOfflineError","pluginLoaded","doctypes","getInfo","database","oldDb","newOptions","adapter","newDb","PouchDB","replicate","plugin","pouchdbFind","createIndexes","createIndex","getReplication","replication","setReplication","getReplicationUrl","basic","toBasicAuth","getReplicationPromise","replicationPromise","setReplicationPromise","promise","live","onError","on","info","onComplete","stop","getRepeatedReplication","interval","setRepeatedReplication","timer","setInterval","clearInterval","currentPassPhrase","newPassPhrase","current_passphrase","new_passphrase","instance","updateRelations","verb","refs","makeReferencesPath","params"],"mappings":"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","file":"cozy-client.node.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b98d5cb102a0e4a75f24","/* global fetch */\nimport { refreshToken, AccessToken } from './auth_v3'\nimport { retry, encodeQuery } from './utils'\nimport jsonapi from './jsonapi'\n\nexport function cozyFetch(cozy, path, options = {}) {\n  return cozy.fullpath(path).then(fullpath => {\n    let resp\n    if (options.disableAuth) {\n      resp = fetch(fullpath, options)\n    } else if (options.manualAuthCredentials) {\n      resp = cozyFetchWithAuth(\n        cozy,\n        fullpath,\n        options,\n        options.manualAuthCredentials\n      )\n    } else {\n      resp = cozy\n        .authorize()\n        .then(credentials =>\n          cozyFetchWithAuth(cozy, fullpath, options, credentials)\n        )\n    }\n    return resp.then(res => handleResponse(res, cozy._invalidTokenErrorHandler))\n  })\n}\n\nfunction cozyFetchWithAuth(cozy, fullpath, options, credentials) {\n  if (credentials) {\n    options.headers = options.headers || {}\n    options.headers['Authorization'] = credentials.token.toAuthHeader()\n  }\n\n  // the option credentials:include tells fetch to include the cookies in the\n  // request even for cross-origin requests\n  options.credentials = 'include'\n\n  return Promise.all([cozy.isV2(), fetch(fullpath, options)]).then(\n    ([isV2, res]) => {\n      if (\n        (res.status !== 400 && res.status !== 401) ||\n        isV2 ||\n        !credentials ||\n        options.dontRetry\n      ) {\n        return res\n      }\n      // we try to refresh the token only for OAuth, ie, the client defined\n      // and the token is an instance of AccessToken.\n      const { client, token } = credentials\n      if (!client || !(token instanceof AccessToken)) {\n        return res\n      }\n      options.dontRetry = true\n      return retry(() => refreshToken(cozy, client, token), 3)()\n        .then(newToken => cozy.saveCredentials(client, newToken))\n        .then(credentials =>\n          cozyFetchWithAuth(cozy, fullpath, options, credentials)\n        )\n    }\n  )\n}\n\nexport function cozyFetchJSON(cozy, method, path, body, options = {}) {\n  const processJSONAPI =\n    typeof options.processJSONAPI === 'undefined' || options.processJSONAPI\n  return fetchJSON(cozy, method, path, body, options).then(response =>\n    handleJSONResponse(response, processJSONAPI)\n  )\n}\n\nexport function cozyFetchRawJSON(cozy, method, path, body, options = {}) {\n  return fetchJSON(cozy, method, path, body, options).then(response =>\n    handleJSONResponse(response, false)\n  )\n}\n\nfunction fetchJSON(cozy, method, path, body, options = {}) {\n  options.method = method\n\n  const headers = (options.headers = options.headers || {})\n\n  headers['Accept'] = 'application/json'\n\n  if (method !== 'GET' && method !== 'HEAD' && body !== undefined) {\n    if (headers['Content-Type']) {\n      options.body = body\n    } else {\n      headers['Content-Type'] = 'application/json'\n      options.body = JSON.stringify(body)\n    }\n  }\n\n  return cozyFetch(cozy, path, options)\n}\n\nfunction handleResponse(res, invalidTokenErrorHandler) {\n  if (res.ok) {\n    return res\n  }\n  let data\n  const contentType = res.headers.get('content-type')\n  if (contentType && contentType.indexOf('json') >= 0) {\n    data = res.json()\n  } else {\n    data = res.text()\n  }\n  return data.then(err => {\n    const error = new FetchError(res, err)\n    if (FetchError.isInvalidToken(error) && invalidTokenErrorHandler) {\n      invalidTokenErrorHandler(error)\n    }\n    throw error\n  })\n}\n\nfunction handleJSONResponse(res, processJSONAPI = true) {\n  const contentType = res.headers.get('content-type')\n  if (!contentType || contentType.indexOf('json') < 0) {\n    return res.text(data => {\n      throw new FetchError(res, new Error('Response is not JSON: ' + data))\n    })\n  }\n\n  const json = res.json()\n  if (contentType.indexOf('application/vnd.api+json') === 0 && processJSONAPI) {\n    return json.then(jsonapi)\n  } else {\n    return json\n  }\n}\n\nexport function handleInvalidTokenError(error) {\n  try {\n    const currentOrigin = window.location.origin\n    const requestUrl = error.url\n\n    if (\n      requestUrl.indexOf(\n        currentOrigin.replace(/^(https?:\\/\\/\\w+)-\\w+\\./, '$1.')\n      ) === 0\n    ) {\n      const redirectURL = `${currentOrigin}?${encodeQuery({ disconnect: 1 })}`\n      window.location = redirectURL\n    }\n  } catch (e) {\n    console.warn('Unable to handle invalid token error', e, error)\n  }\n}\n\nexport class FetchError extends Error {\n  constructor(res, reason) {\n    super()\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, this.constructor)\n    }\n    // XXX We have to hardcode this because babel doesn't play nice when extending Error\n    this.name = 'FetchError'\n    this.response = res\n    this.url = res.url\n    this.status = res.status\n    this.reason = reason\n\n    Object.defineProperty(this, 'message', {\n      value:\n        reason.message ||\n        (typeof reason === 'string' ? reason : JSON.stringify(reason))\n    })\n  }\n}\n\nFetchError.isUnauthorized = function(err) {\n  // XXX We can't use err instanceof FetchError because of the caveats of babel\n  return err.name === 'FetchError' && err.status === 401\n}\n\nFetchError.isNotFound = function(err) {\n  // XXX We can't use err instanceof FetchError because of the caveats of babel\n  return err.name === 'FetchError' && err.status === 404\n}\n\nFetchError.isInvalidToken = function(err) {\n  // XXX We can't use err instanceof FetchError because of the caveats of babel\n  return (\n    err.name === 'FetchError' &&\n    err.status === 400 &&\n    err.reason &&\n    (err.reason.error === 'Invalid JWT token' ||\n      err.reason.error === 'Expired token')\n  )\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/fetch.js","/* global navigator */\nconst FuzzFactor = 0.3\n\nexport function unpromiser(fn) {\n  return function(...args) {\n    const value = fn.apply(this, args)\n    if (!isPromise(value)) {\n      return value\n    }\n    const l = args.length\n    if (l === 0 || typeof args[l - 1] !== 'function') {\n      return\n    }\n    const cb = args[l - 1]\n    value.then(res => cb(null, res), err => cb(err, null))\n  }\n}\n\nexport function isPromise(value) {\n  return !!value && typeof value.then === 'function'\n}\n\nexport function isOnline() {\n  return typeof navigator !== 'undefined' ? navigator.onLine : true\n}\n\nexport function isOffline() {\n  return !isOnline()\n}\n\nexport function sleep(time, args) {\n  return new Promise(resolve => {\n    setTimeout(resolve, time, args)\n  })\n}\n\nexport function retry(fn, count, delay = 300) {\n  return function doTry(...args) {\n    return fn(...args).catch(err => {\n      if (--count < 0) {\n        throw err\n      }\n      return sleep(getBackedoffDelay(delay, count)).then(() => doTry(...args))\n    })\n  }\n}\n\nexport function getFuzzedDelay(retryDelay) {\n  const fuzzingFactor = (Math.random() * 2 - 1) * FuzzFactor\n  return retryDelay * (1.0 + fuzzingFactor)\n}\n\nexport function getBackedoffDelay(retryDelay, retryCount = 1) {\n  return getFuzzedDelay(retryDelay * Math.pow(2, retryCount - 1))\n}\n\nexport function createPath(cozy, isV2, doctype, id = '', query = null) {\n  let route = '/data/'\n  if (!isV2) {\n    route += `${encodeURIComponent(doctype)}/`\n  }\n  if (id !== '') {\n    route += encodeURIComponent(id)\n  }\n  const q = encodeQuery(query)\n  if (q !== '') {\n    route += '?' + q\n  }\n  return route\n}\n\nexport function encodeQuery(query) {\n  if (!query) {\n    return ''\n  }\n  let q = ''\n  for (const qname in query) {\n    if (q !== '') {\n      q += '&'\n    }\n    q += `${encodeURIComponent(qname)}=${encodeURIComponent(query[qname])}`\n  }\n  return q\n}\n\nexport function decodeQuery(url) {\n  let queryIndex = url.indexOf('?')\n  if (queryIndex < 0) {\n    queryIndex = url.length\n  }\n  const queries = {}\n  let fragIndex = url.indexOf('#')\n  if (fragIndex < 0) {\n    fragIndex = url.length\n  }\n  if (fragIndex < queryIndex) {\n    return queries\n  }\n  const queryStr = url.slice(queryIndex + 1, fragIndex)\n  if (queryStr === '') {\n    return queries\n  }\n  const parts = queryStr.split('&')\n  for (let i = 0; i < parts.length; i++) {\n    let pair = parts[i].split('=')\n    if (pair.length === 0 || pair[0] === '') {\n      continue\n    }\n    const qname = decodeURIComponent(pair[0])\n    if (queries.hasOwnProperty(qname)) {\n      continue\n    }\n    if (pair.length === 1) {\n      queries[qname] = true\n    } else if (pair.length === 2) {\n      queries[qname] = decodeURIComponent(pair[1])\n    } else {\n      throw new Error('Malformed URL')\n    }\n  }\n  return queries\n}\n\nconst warned = []\nexport function warn(text) {\n  if (warned.indexOf(text) === -1) {\n    warned.push(text)\n    console.warn('cozy-client-js', text)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","import { warn } from './utils'\n\nexport const DOCTYPE_FILES = 'io.cozy.files'\n\nconst KNOWN_DOCTYPES = {\n  files: DOCTYPE_FILES,\n  folder: DOCTYPE_FILES,\n  contact: 'io.cozy.contacts',\n  event: 'io.cozy.events',\n  track: 'io.cozy.labs.music.track',\n  playlist: 'io.cozy.labs.music.playlist'\n}\n\nconst REVERSE_KNOWN = {}\nObject.keys(KNOWN_DOCTYPES).forEach(k => {\n  REVERSE_KNOWN[KNOWN_DOCTYPES[k]] = k\n})\n\nexport function normalizeDoctype(cozy, isV2, doctype) {\n  let isQualified = doctype.indexOf('.') !== -1\n  if (isV2 && isQualified) {\n    let known = REVERSE_KNOWN[doctype]\n    if (known) return known\n    return doctype.replace(/\\./g, '-')\n  }\n  if (!isV2 && !isQualified) {\n    let known = KNOWN_DOCTYPES[doctype]\n    if (known) {\n      warn(\n        'you are using a non-qualified doctype ' +\n          doctype +\n          ' assumed to be ' +\n          known\n      )\n      return known\n    }\n    throw new Error('Doctype ' + doctype + ' should be qualified.')\n  }\n  return doctype\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/doctypes.js","/* global btoa */\nimport { encodeQuery, decodeQuery, isOffline } from './utils'\nimport { cozyFetchJSON, FetchError } from './fetch'\n\nconst StateSize = 16\n\nexport const CredsKey = 'creds'\nexport const StateKey = 'state'\n\nexport class Client {\n  constructor(opts) {\n    this.clientID = opts.clientID || opts.client_id || ''\n    this.clientSecret = opts.clientSecret || opts.client_secret || ''\n    this.registrationAccessToken =\n      opts.registrationAccessToken || opts.registration_access_token || ''\n\n    if (opts.redirect_uris) {\n      this.redirectURI = opts.redirect_uris[0] || ''\n    } else {\n      this.redirectURI = opts.redirectURI || ''\n    }\n\n    this.softwareID = opts.softwareID || opts.software_id || ''\n    this.softwareVersion = opts.softwareVersion || opts.software_version || ''\n    this.clientName = opts.clientName || opts.client_name || ''\n    this.clientKind = opts.clientKind || opts.client_kind || ''\n    this.clientURI = opts.clientURI || opts.client_uri || ''\n\n    this.logoURI = opts.logoURI || opts.logo_uri || ''\n    this.policyURI = opts.policyURI || opts.policy_uri || ''\n\n    this.notificationPlatform =\n      opts.notificationPlatform || opts.notification_platform || ''\n    this.notificationDeviceToken =\n      opts.notificationDeviceToken || opts.notification_device_token || ''\n\n    if (!this.registrationAccessToken) {\n      if (this.redirectURI === '') {\n        throw new Error('Missing redirectURI field')\n      }\n      if (this.softwareID === '') {\n        throw new Error('Missing softwareID field')\n      }\n      if (this.clientName === '') {\n        throw new Error('Missing clientName field')\n      }\n    }\n  }\n\n  isRegistered() {\n    return this.clientID !== ''\n  }\n\n  toRegisterJSON() {\n    return {\n      redirect_uris: [this.redirectURI],\n      software_id: this.softwareID,\n      software_version: this.softwareVersion,\n      client_name: this.clientName,\n      client_kind: this.clientKind,\n      client_uri: this.clientURI,\n      logo_uri: this.logoURI,\n      policy_uri: this.policyURI,\n      notification_platform: this.notificationPlatform,\n      notification_device_token: this.notificationDeviceToken\n    }\n  }\n\n  toAuthHeader() {\n    return 'Bearer ' + this.registrationAccessToken\n  }\n}\n\nexport class AccessToken {\n  constructor(opts) {\n    this.tokenType = opts.tokenType || opts.token_type\n    this.accessToken = opts.accessToken || opts.access_token\n    this.refreshToken = opts.refreshToken || opts.refresh_token\n    this.scope = opts.scope\n  }\n\n  toAuthHeader() {\n    return 'Bearer ' + this.accessToken\n  }\n\n  toBasicAuth() {\n    return `user:${this.accessToken}@`\n  }\n}\n\nexport class AppToken {\n  constructor(opts) {\n    this.token = opts.token || ''\n  }\n\n  toAuthHeader() {\n    return 'Bearer ' + this.token\n  }\n\n  toBasicAuth() {\n    return `user:${this.token}@`\n  }\n}\n\nexport function client(cozy, clientParams) {\n  if (!clientParams) {\n    clientParams = cozy._clientParams\n  }\n  if (clientParams instanceof Client) {\n    return clientParams\n  }\n  return new Client(clientParams)\n}\n\nexport function registerClient(cozy, clientParams) {\n  const cli = client(cozy, clientParams)\n  if (cli.isRegistered()) {\n    return Promise.reject(new Error('Client already registered'))\n  }\n  return cozyFetchJSON(cozy, 'POST', '/auth/register', cli.toRegisterJSON(), {\n    disableAuth: true\n  }).then(data => new Client(data))\n}\n\nexport function updateClient(cozy, clientParams, resetSecret = false) {\n  const cli = client(cozy, clientParams)\n  if (!cli.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  let data = cli.toRegisterJSON()\n  data.client_id = cli.clientID\n  if (resetSecret) data.client_secret = cli.clientSecret\n\n  return cozyFetchJSON(cozy, 'PUT', `/auth/register/${cli.clientID}`, data, {\n    manualAuthCredentials: {\n      token: cli\n    }\n  }).then(data => createClient(data, cli))\n}\n\nexport function unregisterClient(cozy, clientParams) {\n  const cli = client(cozy, clientParams)\n  if (!cli.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  return cozyFetchJSON(cozy, 'DELETE', `/auth/register/${cli.clientID}`, null, {\n    manualAuthCredentials: {\n      token: cli\n    }\n  })\n}\n\n// getClient will retrive the registered client informations from the server.\nexport function getClient(cozy, clientParams) {\n  const cli = client(cozy, clientParams)\n  if (!cli.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  if (isOffline()) {\n    return Promise.resolve(cli)\n  }\n  return cozyFetchJSON(cozy, 'GET', `/auth/register/${cli.clientID}`, null, {\n    manualAuthCredentials: {\n      token: cli\n    }\n  })\n    .then(data => createClient(data, cli))\n    .catch(err => {\n      // If we fall into an error while fetching the client (because of a\n      // bad connectivity for instance), we do not bail the whole process\n      // since the client should be able to continue with the persisted\n      // client and token.\n      //\n      // If it is an explicit Unauthorized error though, we bail, clear th\n      // cache and retry.\n      if (FetchError.isUnauthorized(err) || FetchError.isNotFound(err)) {\n        throw new Error('Client has been revoked')\n      }\n      throw err\n    })\n}\n\n// createClient returns a new Client instance given on object containing the\n// data of the client, from the API, and an old instance of the client.\nfunction createClient(data, oldClient) {\n  const newClient = new Client(data)\n  // we need to keep track of the registrationAccessToken since it is send\n  // only on registration. The GET /auth/register/:client-id endpoint does\n  // not return this token.\n  const shouldPassRegistration =\n    !!oldClient &&\n    oldClient.registrationAccessToken !== '' &&\n    newClient.registrationAccessToken === ''\n  if (shouldPassRegistration) {\n    newClient.registrationAccessToken = oldClient.registrationAccessToken\n  }\n  return newClient\n}\n\n// getAuthCodeURL returns a pair {authURL,state} given a registered client. The\n// state should be stored in order to be checked against on the user validation\n// phase.\nexport function getAuthCodeURL(cozy, client, scopes = []) {\n  if (!(client instanceof Client)) {\n    client = new Client(client)\n  }\n  if (!client.isRegistered()) {\n    throw new Error('Client not registered')\n  }\n  const state = generateRandomState()\n  const query = {\n    client_id: client.clientID,\n    redirect_uri: client.redirectURI,\n    state: state,\n    response_type: 'code',\n    scope: scopes.join(' ')\n  }\n  return {\n    url: cozy._url + `/auth/authorize?${encodeQuery(query)}`,\n    state: state\n  }\n}\n\n// getAccessToken perform a request on the access_token entrypoint with the\n// authorization_code grant type in order to generate a new access token for a\n// newly registered client.\n//\n// This method extracts the access code and state from the given URL. By\n// default it uses window.location.href. Also, it checks the given state with\n// the one specified in the URL query parameter to prevent CSRF attacks.\nexport function getAccessToken(cozy, client, state, pageURL = '') {\n  if (!state) {\n    return Promise.reject(new Error('Missing state value'))\n  }\n  const grantQueries = getGrantCodeFromPageURL(pageURL)\n  if (grantQueries === null) {\n    return Promise.reject(new Error('Missing states from current URL'))\n  }\n  if (state !== grantQueries.state) {\n    return Promise.reject(\n      new Error('Given state does not match url query state')\n    )\n  }\n  return retrieveToken(cozy, client, null, {\n    grant_type: 'authorization_code',\n    code: grantQueries.code\n  })\n}\n\n// refreshToken perform a request on the access_token entrypoint with the\n// refresh_token grant type in order to refresh the given token.\nexport function refreshToken(cozy, client, token) {\n  return retrieveToken(cozy, client, token, {\n    grant_type: 'refresh_token',\n    refresh_token: token.refreshToken\n  })\n}\n\n// oauthFlow performs the stateful registration and access granting of an OAuth\n// client.\nexport function oauthFlow(\n  cozy,\n  storage,\n  clientParams,\n  onRegistered,\n  ignoreCachedCredentials = false\n) {\n  if (ignoreCachedCredentials) {\n    return storage\n      .clear()\n      .then(() => oauthFlow(cozy, storage, clientParams, onRegistered, false))\n  }\n\n  let tryCount = 0\n\n  function clearAndRetry(err) {\n    if (tryCount++ > 0) {\n      throw err\n    }\n    return storage\n      .clear()\n      .then(() => oauthFlow(cozy, storage, clientParams, onRegistered))\n  }\n\n  function registerNewClient() {\n    return storage\n      .clear()\n      .then(() => registerClient(cozy, clientParams))\n      .then(client => {\n        const { url, state } = getAuthCodeURL(cozy, client, clientParams.scopes)\n        return storage.save(StateKey, { client, url, state })\n      })\n  }\n\n  return Promise.all([storage.load(CredsKey), storage.load(StateKey)])\n    .then(([credentials, storedState]) => {\n      // If credentials are cached we re-fetch the registered client with the\n      // said token. Fetching the client, if the token is outdated we should try\n      // the token is refreshed.\n      if (credentials) {\n        let oldClient, token\n        try {\n          oldClient = new Client(credentials.client)\n          token = new AccessToken(credentials.token)\n        } catch (err) {\n          // bad cache, we should clear and retry the process\n          return clearAndRetry(err)\n        }\n        return getClient(cozy, oldClient)\n          .then(client => ({ client, token }))\n          .catch(err => {\n            // If we fall into an error while fetching the client (because of a\n            // bad connectivity for instance), we do not bail the whole process\n            // since the client should be able to continue with the persisted\n            // client and token.\n            //\n            // If it is an explicit Unauthorized error though, we bail, clear th\n            // cache and retry.\n            if (FetchError.isUnauthorized(err) || FetchError.isNotFound(err)) {\n              throw new Error('Client has been revoked')\n            }\n            return { client: oldClient, token }\n          })\n      }\n\n      // Otherwise register a new client if necessary (ie. no client is stored)\n      // and call the onRegistered callback to wait for the user to grant the\n      // access. Finally fetches to access token on success.\n      let statePromise\n      if (!storedState) {\n        statePromise = registerNewClient()\n      } else {\n        statePromise = Promise.resolve(storedState)\n      }\n\n      let client, state, token\n      return statePromise\n        .then(data => {\n          client = data.client\n          state = data.state\n          return Promise.resolve(onRegistered(client, data.url))\n        })\n        .then(pageURL => getAccessToken(cozy, client, state, pageURL))\n        .then(t => {\n          token = t\n        })\n        .then(() => storage.delete(StateKey))\n        .then(() => ({ client, token }))\n    })\n    .then(\n      creds => storage.save(CredsKey, creds),\n      err => {\n        if (FetchError.isUnauthorized(err)) {\n          return clearAndRetry(err)\n        } else {\n          throw err\n        }\n      }\n    )\n}\n\n// retrieveToken perform a request on the access_token entrypoint in order to\n// fetch a token.\nfunction retrieveToken(cozy, client, token, query) {\n  if (!(client instanceof Client)) {\n    client = new Client(client)\n  }\n  if (!client.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  const body = encodeQuery(\n    Object.assign({}, query, {\n      client_id: client.clientID,\n      client_secret: client.clientSecret\n    })\n  )\n  return cozyFetchJSON(cozy, 'POST', '/auth/access_token', body, {\n    disableAuth: token === null,\n    dontRetry: true,\n    manualAuthCredentials: { client, token },\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\n  }).then(data => {\n    data.refreshToken = data.refreshToken || query.refresh_token\n    return new AccessToken(data)\n  })\n}\n\n// getGrantCodeFromPageURL extract the state and code query parameters from the\n// given url\nfunction getGrantCodeFromPageURL(pageURL = '') {\n  if (pageURL === '' && typeof window !== 'undefined') {\n    pageURL = window.location.href\n  }\n  const queries = decodeQuery(pageURL)\n  if (!queries.hasOwnProperty('state')) {\n    return null\n  }\n  return {\n    state: queries['state'],\n    code: queries['code']\n  }\n}\n\n// generateRandomState will try to generate a 128bits random value from a secure\n// pseudo random generator. It will fallback on Math.random if it cannot find\n// such generator.\nfunction generateRandomState() {\n  let buffer\n  if (\n    typeof window !== 'undefined' &&\n    typeof window.crypto !== 'undefined' &&\n    typeof window.crypto.getRandomValues === 'function'\n  ) {\n    buffer = new Uint8Array(StateSize)\n    window.crypto.getRandomValues(buffer)\n  } else {\n    try {\n      buffer = require('crypto').randomBytes(StateSize)\n    } catch (e) {\n      buffer = null\n    }\n  }\n  if (!buffer) {\n    buffer = new Array(StateSize)\n    for (let i = 0; i < buffer.length; i++) {\n      buffer[i] = Math.floor(Math.random() * 255)\n    }\n  }\n  return btoa(String.fromCharCode.apply(null, buffer))\n    .replace(/=+$/, '')\n    .replace(/\\//g, '_')\n    .replace(/\\+/g, '-')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_v3.js","module.exports = require(\"babel-runtime/regenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/regenerator\"\n// module id = 4\n// module chunks = 0","// helper to serialize/deserialize an error for/from postMessage\nexport const errorSerializer = (() => {\n  function mapErrorProperties(from, to) {\n    const result = Object.assign(to, from)\n    const nativeProperties = ['name', 'message']\n    return nativeProperties.reduce((result, property) => {\n      if (from[property]) {\n        to[property] = from[property]\n      }\n      return result\n    }, result)\n  }\n  return {\n    serialize: error => mapErrorProperties(error, {}),\n    deserialize: data => mapErrorProperties(data, new Error(data.message))\n  }\n})()\n\nconst first = arr => arr && arr[0]\n// In a far future, the user will have to pick the desired service from a list.\n// For now it's our job, an easy job as we arbitrary pick the first service of\n// the list.\nexport function pickService(intent, filterServices) {\n  const services = intent.attributes.services\n  const filteredServices = filterServices\n    ? (services || []).filter(filterServices)\n    : services\n  return first(filteredServices)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/intents/helpers.js","module.exports = require(\"isomorphic-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"isomorphic-fetch\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"btoa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"btoa\"\n// module id = 7\n// module chunks = 0","function indexKey(doc) {\n  return doc.type + '/' + doc.id\n}\n\nfunction findByRef(resources, ref) {\n  return resources[indexKey(ref)]\n}\n\nfunction handleResource(rawResource, resources, links) {\n  let resource = {\n    _id: rawResource.id,\n    _type: rawResource.type,\n    _rev: rawResource.meta && rawResource.meta.rev,\n    links: Object.assign({}, rawResource.links, links),\n    attributes: rawResource.attributes,\n    relations: name => {\n      let rels = rawResource.relationships[name]\n      if (rels === undefined || rels.data === undefined) return undefined\n      if (rels.data === null) return null\n      if (!Array.isArray(rels.data)) return findByRef(resources, rels.data)\n      return rels.data.map(ref => findByRef(resources, ref))\n    }\n  }\n  if (rawResource.relationships) {\n    resource.relationships = rawResource.relationships\n  }\n\n  resources[indexKey(rawResource)] = resource\n\n  return resource\n}\n\nfunction handleTopLevel(doc, resources = {}) {\n  // build an index of included resource by Type & ID\n  const included = doc.included\n\n  if (Array.isArray(included)) {\n    included.forEach(r => handleResource(r, resources, doc.links))\n  }\n\n  if (Array.isArray(doc.data)) {\n    return doc.data.map(r => handleResource(r, resources, doc.links))\n  } else {\n    return handleResource(doc.data, resources, doc.links)\n  }\n}\n\nexport default handleTopLevel\n\n\n\n// WEBPACK FOOTER //\n// ./src/jsonapi.js","import { cozyFetchJSON } from '../fetch'\nimport { pickService } from './helpers'\nimport * as client from './client'\nimport * as service from './service'\n\nexport function create(cozy, action, type, data = {}, permissions = []) {\n  if (!action)\n    throw new Error(`Misformed intent, \"action\" property must be provided`)\n  if (!type)\n    throw new Error(`Misformed intent, \"type\" property must be provided`)\n\n  const createPromise = cozyFetchJSON(cozy, 'POST', '/intents', {\n    data: {\n      type: 'io.cozy.intents',\n      attributes: {\n        action: action,\n        type: type,\n        data: data,\n        permissions: permissions\n      }\n    }\n  })\n\n  createPromise.start = (element, onReadyCallback) => {\n    const options = {\n      filteredServices: data.filteredServices,\n      onReadyCallback: onReadyCallback\n    }\n\n    delete data.filteredServices\n\n    return createPromise.then(intent =>\n      client.start(cozy, intent, element, data, options)\n    )\n  }\n\n  return createPromise\n}\n\n// returns a service to communicate with intent client\nexport function createService(cozy, intentId, serviceWindow) {\n  return service.start(cozy, intentId, serviceWindow)\n}\n\nfunction removeQueryString(url) {\n  return url.replace(/\\?[^/#]*/, '')\n}\n\n// Redirect to an app able to handle the doctype\n// Redirections are more or less a hack of the intent API to retrieve an URL for\n// accessing a given doctype or a given document.\n// It needs to use a special action `REDIRECT`\nexport async function getRedirectionURL(cozy, type, data) {\n  if (!type && !data)\n    throw new Error(\n      `Cannot retrieve redirection, at least type or doc must be provided`\n    )\n\n  const intent = await create(cozy, 'REDIRECT', type, data)\n\n  const service = pickService(intent)\n  if (!service) throw new Error('Unable to find a service')\n\n  // Intents cannot be deleted now\n  // await deleteIntent(cozy, intent)\n\n  const baseURL = removeQueryString(service.href)\n  return data ? buildRedirectionURL(baseURL, data) : baseURL\n}\n\nfunction isSerializable(value) {\n  return !['object', 'function'].includes(typeof value)\n}\n\nfunction buildRedirectionURL(url, data) {\n  const parameterStrings = Object.keys(data)\n    .filter(key => isSerializable(data[key]))\n    .map(key => `${key}=${data[key]}`)\n\n  return parameterStrings.length ? `${url}?${parameterStrings.join('&')}` : url\n}\n\nexport async function redirect(cozy, type, doc, redirectFn) {\n  if (!window)\n    throw new Error('redirect() method can only be called in a browser')\n  const redirectionURL = await getRedirectionURL(cozy, type, doc)\n  if (redirectFn && typeof redirectFn === 'function') {\n    return redirectFn(redirectionURL)\n  }\n\n  window.location.href = redirectionURL\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/intents/index.js","/* global fetch URL */\nimport 'core-js/modules/es6.object.assign'\nimport { unpromiser, retry, warn } from './utils'\nimport { LocalStorage, MemoryStorage } from './auth_storage'\nimport { AppToken as AppTokenV2, getAppToken as getAppTokenV2 } from './auth_v2'\nimport * as auth from './auth_v3'\nimport * as data from './data'\nimport * as cozyFetch from './fetch'\nimport * as mango from './mango'\nimport * as files from './files'\nimport * as intents from './intents/'\nimport * as jobs from './jobs'\nimport * as offline from './offline'\nimport * as settings from './settings'\nimport * as relations from './relations'\n\nconst {\n  AppToken: AppTokenV3,\n  AccessToken: AccessTokenV3,\n  Client: ClientV3\n} = auth\n\nconst AuthNone = 0\nconst AuthRunning = 1\nconst AuthError = 2\nconst AuthOK = 3\n\nconst defaultClientParams = {\n  softwareID: 'github.com/cozy/cozy-client-js'\n}\n\nconst dataProto = {\n  create: data.create,\n  find: data.find,\n  findMany: data.findMany,\n  findAll: data.findAll,\n  update: data.update,\n  delete: data._delete,\n  updateAttributes: data.updateAttributes,\n  changesFeed: data.changesFeed,\n  defineIndex: mango.defineIndex,\n  query: mango.query,\n  addReferencedFiles: relations.addReferencedFiles,\n  removeReferencedFiles: relations.removeReferencedFiles,\n  listReferencedFiles: relations.listReferencedFiles,\n  fetchReferencedFiles: relations.fetchReferencedFiles,\n  destroy: function(...args) {\n    warn('destroy is deprecated, use cozy.data.delete instead.')\n    return data._delete(...args)\n  }\n}\n\nconst authProto = {\n  client: auth.client,\n  registerClient: auth.registerClient,\n  updateClient: auth.updateClient,\n  unregisterClient: auth.unregisterClient,\n  getClient: auth.getClient,\n  getAuthCodeURL: auth.getAuthCodeURL,\n  getAccessToken: auth.getAccessToken,\n  refreshToken: auth.refreshToken\n}\n\nconst filesProto = {\n  create: files.create,\n  createDirectory: files.createDirectory,\n  createDirectoryByPath: files.createDirectoryByPath,\n  updateById: files.updateById,\n  updateAttributesById: files.updateAttributesById,\n  updateAttributesByPath: files.updateAttributesByPath,\n  trashById: files.trashById,\n  statById: files.statById,\n  statByPath: files.statByPath,\n  downloadById: files.downloadById,\n  downloadByPath: files.downloadByPath,\n  getDownloadLinkById: files.getDownloadLinkById,\n  getDownloadLink: files.getDownloadLinkByPath, // DEPRECATED, should be removed very soon\n  getDownloadLinkByPath: files.getDownloadLinkByPath,\n  getArchiveLink: function(...args) {\n    warn(\n      'getArchiveLink is deprecated, use cozy.files.getArchiveLinkByPaths instead.'\n    )\n    return files.getArchiveLinkByPaths(...args)\n  },\n  getArchiveLinkByPaths: files.getArchiveLinkByPaths,\n  getArchiveLinkByIds: files.getArchiveLinkByIds,\n  getFilePath: files.getFilePath,\n  getCollectionShareLink: files.getCollectionShareLink,\n  query: mango.queryFiles,\n  listTrash: files.listTrash,\n  clearTrash: files.clearTrash,\n  restoreById: files.restoreById,\n  destroyById: files.destroyById\n}\n\nconst intentsProto = {\n  create: intents.create,\n  createService: intents.createService,\n  getRedirectionURL: intents.getRedirectionURL,\n  redirect: intents.redirect\n}\n\nconst jobsProto = {\n  create: jobs.create,\n  count: jobs.count,\n  queued: jobs.queued\n}\n\nconst offlineProto = {\n  init: offline.init,\n  getDoctypes: offline.getDoctypes,\n  // database\n  hasDatabase: offline.hasDatabase,\n  getDatabase: offline.getDatabase,\n  createDatabase: offline.createDatabase,\n  migrateDatabase: offline.migrateDatabase,\n  destroyDatabase: offline.destroyDatabase,\n  destroyAllDatabase: offline.destroyAllDatabase,\n  // replication\n  hasReplication: offline.hasReplication,\n  replicateFromCozy: offline.replicateFromCozy,\n  stopReplication: offline.stopReplication,\n  stopAllReplication: offline.stopAllReplication,\n  // repeated replication\n  hasRepeatedReplication: offline.hasRepeatedReplication,\n  startRepeatedReplication: offline.startRepeatedReplication,\n  stopRepeatedReplication: offline.stopRepeatedReplication,\n  stopAllRepeatedReplication: offline.stopAllRepeatedReplication\n}\n\nconst settingsProto = {\n  diskUsage: settings.diskUsage,\n  changePassphrase: settings.changePassphrase,\n  getInstance: settings.getInstance,\n  updateInstance: settings.updateInstance,\n  getClients: settings.getClients,\n  deleteClientById: settings.deleteClientById,\n  updateLastSync: settings.updateLastSync\n}\n\nconst ensureHasReconnectParam = _url => {\n  const url = new URL(_url)\n  if (url.searchParams && !url.searchParams.has('reconnect')) {\n    url.searchParams.append('reconnect', 1)\n  } else if (!url.search || url.search.indexOf('reconnect') === -1) {\n    // Some old navigators do not have the searchParams API\n    // and it is not polyfilled by babel-polyfill\n    url.search = url.search + '&reconnect=1'\n  }\n  return url.toString()\n}\n\nclass Client {\n  constructor(options) {\n    this.data = {}\n    this.files = {}\n    this.intents = {}\n    this.jobs = {}\n    this.offline = {}\n    this.settings = {}\n    this.auth = {\n      Client: ClientV3,\n      AccessToken: AccessTokenV3,\n      AppToken: AppTokenV3,\n      AppTokenV2: AppTokenV2,\n      LocalStorage: LocalStorage,\n      MemoryStorage: MemoryStorage\n    }\n    this._inited = false\n    if (options) {\n      this.init(options)\n    }\n  }\n\n  init(options = {}) {\n    this._inited = true\n    this._oauth = false // is oauth activated or not\n    this._token = null // application token\n    this._authstate = AuthNone\n    this._authcreds = null\n    this._storage = null\n    this._version = options.version || null\n    this._offline = null\n\n    const token = options.token\n    const oauth = options.oauth\n    if (token && oauth) {\n      throw new Error(\n        'Cannot specify an application token with a oauth activated'\n      )\n    }\n\n    if (token) {\n      this._token = new AppTokenV3({ token })\n    } else if (oauth) {\n      this._oauth = true\n      this._storage = oauth.storage\n      this._clientParams = Object.assign(\n        {},\n        defaultClientParams,\n        oauth.clientParams\n      )\n      this._onRegistered = oauth.onRegistered || nopOnRegistered\n    }\n\n    let url = options.cozyURL || ''\n    while (url[url.length - 1] === '/') {\n      url = url.slice(0, -1)\n    }\n\n    this._url = url\n\n    this._invalidTokenErrorHandler =\n      options.onInvalidTokenError !== undefined\n        ? options.onInvalidTokenError\n        : cozyFetch.handleInvalidTokenError\n\n    const disablePromises = !!options.disablePromises\n    addToProto(this, this.data, dataProto, disablePromises)\n    addToProto(this, this.auth, authProto, disablePromises)\n    addToProto(this, this.files, filesProto, disablePromises)\n    addToProto(this, this.intents, intentsProto, disablePromises)\n    addToProto(this, this.jobs, jobsProto, disablePromises)\n    addToProto(this, this.offline, offlineProto, disablePromises)\n    addToProto(this, this.settings, settingsProto, disablePromises)\n\n    if (options.offline) {\n      this.offline.init(options.offline)\n    }\n\n    this.fetch = function _fetch(method, url, options = {}) {\n      return cozyFetch.cozyFetch(this, url, { ...options, method })\n    }\n\n    this.fetchJSON = function _fetchJSON() {\n      const args = [this].concat(Array.prototype.slice.call(arguments))\n      return cozyFetch.cozyFetchJSON.apply(this, args)\n    }\n  }\n\n  authorize(forceTokenRefresh = false) {\n    const state = this._authstate\n    if (state === AuthOK || state === AuthRunning) {\n      return this._authcreds\n    }\n\n    this._authstate = AuthRunning\n    this._authcreds = this.isV2().then(isV2 => {\n      if (isV2 && this._oauth) {\n        throw new Error('OAuth is not supported on the V2 stack')\n      }\n      if (this._oauth) {\n        if (forceTokenRefresh && this._clientParams.redirectURI) {\n          this._clientParams.redirectURI = ensureHasReconnectParam(\n            this._clientParams.redirectURI\n          )\n        }\n        return auth.oauthFlow(\n          this,\n          this._storage,\n          this._clientParams,\n          this._onRegistered,\n          forceTokenRefresh\n        )\n      }\n      // we expect to be on a client side application running in a browser\n      // with cookie-based authentication.\n      if (isV2) {\n        return getAppTokenV2()\n      } else if (this._token) {\n        return Promise.resolve({ client: null, token: this._token })\n      } else {\n        throw new Error('Missing application token')\n      }\n    })\n\n    this._authcreds.then(\n      () => {\n        this._authstate = AuthOK\n      },\n      () => {\n        this._authstate = AuthError\n      }\n    )\n\n    return this._authcreds\n  }\n\n  saveCredentials(client, token) {\n    const creds = { client, token }\n    if (!this._storage || this._authstate === AuthRunning) {\n      return Promise.resolve(creds)\n    }\n    this._storage.save(auth.CredsKey, creds)\n    this._authcreds = Promise.resolve(creds)\n    return this._authcreds\n  }\n\n  fullpath(path) {\n    return this.isV2().then(isV2 => {\n      const pathprefix = isV2 ? '/ds-api' : ''\n      return this._url + pathprefix + path\n    })\n  }\n\n  isV2() {\n    if (!this._version) {\n      return retry(() => fetch(`${this._url}/status/`), 3)()\n        .then(res => {\n          if (!res.ok) {\n            throw new Error('Could not fetch cozy status')\n          } else {\n            return res.json()\n          }\n        })\n        .then(status => {\n          this._version = status.datasystem !== undefined ? 2 : 3\n          return this.isV2()\n        })\n    }\n    return Promise.resolve(this._version === 2)\n  }\n}\n\nfunction nopOnRegistered() {\n  throw new Error('Missing onRegistered callback')\n}\n\nfunction protoify(context, fn) {\n  return function prototyped(...args) {\n    return fn(context, ...args)\n  }\n}\n\nfunction addToProto(ctx, obj, proto, disablePromises) {\n  for (const attr in proto) {\n    let fn = protoify(ctx, proto[attr])\n    if (disablePromises) {\n      fn = unpromiser(fn)\n    }\n    obj[attr] = fn\n  }\n}\n\nmodule.exports = new Client()\nObject.assign(module.exports, { Client, LocalStorage, MemoryStorage })\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"core-js/modules/es6.object.assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.object.assign\"\n// module id = 11\n// module chunks = 0","export class LocalStorage {\n  constructor(storage, prefix) {\n    if (!storage && typeof window !== 'undefined') {\n      storage = window.localStorage\n    }\n    this.storage = storage\n    this.prefix = prefix || 'cozy:oauth:'\n  }\n\n  save(key, value) {\n    return new Promise(resolve => {\n      this.storage.setItem(this.prefix + key, JSON.stringify(value))\n      resolve(value)\n    })\n  }\n\n  load(key) {\n    return new Promise(resolve => {\n      const item = this.storage.getItem(this.prefix + key)\n      if (!item) {\n        resolve()\n      } else {\n        resolve(JSON.parse(item))\n      }\n    })\n  }\n\n  delete(key) {\n    return new Promise(resolve =>\n      resolve(this.storage.removeItem(this.prefix + key))\n    )\n  }\n\n  clear() {\n    return new Promise(resolve => {\n      const storage = this.storage\n      for (let i = 0; i < storage.length; i++) {\n        const key = storage.key(i)\n        if (key.indexOf(this.prefix) === 0) {\n          storage.removeItem(key)\n        }\n      }\n      resolve()\n    })\n  }\n}\n\nexport class MemoryStorage {\n  constructor() {\n    this.hash = Object.create(null)\n  }\n\n  save(key, value) {\n    this.hash[key] = value\n    return Promise.resolve(value)\n  }\n\n  load(key) {\n    return Promise.resolve(this.hash[key])\n  }\n\n  delete(key) {\n    const deleted = delete this.hash[key]\n    return Promise.resolve(deleted)\n  }\n\n  clear() {\n    this.hash = Object.create(null)\n    return Promise.resolve()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_storage.js","/* global btoa */\nconst V2TOKEN_ABORT_TIMEOUT = 3000\n\nexport function getAppToken() {\n  return new Promise(function(resolve, reject) {\n    if (typeof window === 'undefined') {\n      return reject(new Error('getV2Token should be used in browser'))\n    } else if (!window.parent) {\n      return reject(new Error('getV2Token should be used in iframe'))\n    } else if (!window.parent.postMessage) {\n      return reject(new Error('getV2Token should be used in modern browser'))\n    }\n    const origin = window.location.origin\n    const intent = { action: 'getToken' }\n    let timeout = null\n    const receiver = function(event) {\n      let token\n      try {\n        token = new AppToken({\n          appName: event.data.appName,\n          token: event.data.token\n        })\n      } catch (e) {\n        reject(e)\n        return\n      }\n      window.removeEventListener('message', receiver)\n      clearTimeout(timeout)\n      resolve({ client: null, token })\n    }\n    window.addEventListener('message', receiver, false)\n    window.parent.postMessage(intent, origin)\n    timeout = setTimeout(() => {\n      reject(new Error('No response from parent iframe after 3s'))\n    }, V2TOKEN_ABORT_TIMEOUT)\n  })\n}\n\nexport class AppToken {\n  constructor(opts) {\n    this.appName = opts.appName || ''\n    this.token = opts.token || ''\n  }\n\n  toAuthHeader() {\n    return 'Basic ' + btoa(`${this.appName}:${this.token}`)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_v2.js","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 14\n// module chunks = 0","import { createPath } from './utils'\nimport { normalizeDoctype } from './doctypes'\nimport { cozyFetchJSON } from './fetch'\n\nconst NOREV = 'stack-v2-no-rev'\n\nexport function create(cozy, doctype, attributes) {\n  return cozy.isV2().then(isV2 => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    if (isV2) {\n      attributes.docType = doctype\n    }\n    const path = createPath(cozy, isV2, doctype, attributes._id)\n    const httpVerb = attributes._id ? 'PUT' : 'POST'\n    delete attributes._id\n    return cozyFetchJSON(cozy, httpVerb, path, attributes).then(resp => {\n      if (isV2) {\n        return find(cozy, doctype, resp._id)\n      } else {\n        return resp.data\n      }\n    })\n  })\n}\n\nexport function find(cozy, doctype, id) {\n  return cozy.isV2().then(isV2 => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n\n    if (!id) {\n      return Promise.reject(new Error('Missing id parameter'))\n    }\n\n    const path = createPath(cozy, isV2, doctype, id)\n    return cozyFetchJSON(cozy, 'GET', path).then(resp => {\n      if (isV2) {\n        return Object.assign(resp, { _rev: NOREV })\n      } else {\n        return resp\n      }\n    })\n  })\n}\n\nexport function findMany(cozy, doctype, ids) {\n  if (!(ids instanceof Array)) {\n    return Promise.reject(new Error('Parameter ids must be a non-empty array'))\n  }\n  if (ids.length === 0) {\n    // So users don't need to be defensive regarding the array content.\n    // This should not hide issues in user code since the result will be an\n    // empty object anyway.\n    return Promise.resolve({})\n  }\n\n  return cozy.isV2().then(isV2 => {\n    if (isV2) {\n      return Promise.reject(new Error('findMany is not available on v2'))\n    }\n\n    const path = createPath(cozy, isV2, doctype, '_all_docs', {\n      include_docs: true\n    })\n\n    return cozyFetchJSON(cozy, 'POST', path, { keys: ids })\n      .then(resp => {\n        const docs = {}\n\n        for (const row of resp.rows) {\n          const { key, doc, error } = row\n          docs[key] = error ? { error } : { doc }\n        }\n\n        return docs\n      })\n      .catch(error => {\n        if (error.status !== 404) return Promise.reject(error)\n\n        // When no doc was ever created and the database does not exist yet,\n        // the response will be a 404 error.\n        const docs = {}\n\n        for (const id of ids) {\n          docs[id] = { error }\n        }\n\n        return docs\n      })\n  })\n}\n\nexport function findAll(cozy, doctype) {\n  return cozy.isV2().then(isV2 => {\n    if (isV2) {\n      return Promise.reject(new Error('findAll is not available on v2'))\n    }\n\n    const path = createPath(cozy, isV2, doctype, '_all_docs', {\n      include_docs: true\n    })\n\n    return cozyFetchJSON(cozy, 'POST', path, {})\n      .then(resp => {\n        const docs = []\n\n        for (const row of resp.rows) {\n          const { doc } = row\n          // if not couchDB indexes\n          if (!doc._id.match(/_design\\//)) docs.push(doc)\n        }\n        return docs\n      })\n      .catch(error => {\n        // the _all_docs endpoint returns a 404 error if no document with the given\n        // doctype exists.\n        if (error.status === 404) return []\n        throw error\n      })\n  })\n}\n\nexport function changesFeed(cozy, doctype, options) {\n  return cozy.isV2().then(isV2 => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const path = createPath(cozy, isV2, doctype, '_changes', options)\n    return cozyFetchJSON(cozy, 'GET', path)\n  })\n}\n\nexport function update(cozy, doctype, doc, changes) {\n  return cozy.isV2().then(isV2 => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const { _id, _rev } = doc\n\n    if (!_id) {\n      return Promise.reject(new Error('Missing _id field in passed document'))\n    }\n\n    if (!isV2 && !_rev) {\n      return Promise.reject(new Error('Missing _rev field in passed document'))\n    }\n\n    if (isV2) {\n      changes = Object.assign({ _id }, changes)\n    } else {\n      changes = Object.assign({ _id, _rev }, changes)\n    }\n\n    const path = createPath(cozy, isV2, doctype, _id)\n    return cozyFetchJSON(cozy, 'PUT', path, changes).then(resp => {\n      if (isV2) {\n        return find(cozy, doctype, _id)\n      } else {\n        return resp.data\n      }\n    })\n  })\n}\n\nexport function updateAttributes(cozy, doctype, _id, changes, tries = 3) {\n  return cozy.isV2().then(isV2 => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    return find(cozy, doctype, _id)\n      .then(doc => {\n        return update(cozy, doctype, doc, Object.assign({ _id }, doc, changes))\n      })\n      .catch(err => {\n        if (tries > 0) {\n          return updateAttributes(cozy, doctype, _id, changes, tries - 1)\n        } else {\n          throw err\n        }\n      })\n  })\n}\n\nexport function _delete(cozy, doctype, doc) {\n  return cozy.isV2().then(isV2 => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const { _id, _rev } = doc\n\n    if (!_id) {\n      return Promise.reject(new Error('Missing _id field in passed document'))\n    }\n\n    if (!isV2 && !_rev) {\n      return Promise.reject(new Error('Missing _rev field in passed document'))\n    }\n\n    const query = isV2 ? null : { rev: _rev }\n    const path = createPath(cozy, isV2, doctype, _id, query)\n    return cozyFetchJSON(cozy, 'DELETE', path).then(resp => {\n      if (isV2) {\n        return { id: _id, rev: NOREV }\n      } else {\n        return resp\n      }\n    })\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/data.js","import { warn, createPath, sleep } from './utils'\nimport { normalizeDoctype } from './doctypes'\nimport { cozyFetchJSON, cozyFetchRawJSON } from './fetch'\n\nexport function defineIndex(cozy, doctype, fields) {\n  return cozy.isV2().then(isV2 => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    if (!Array.isArray(fields) || fields.length === 0) {\n      throw new Error('defineIndex fields should be a non-empty array')\n    }\n    if (isV2) {\n      return defineIndexV2(cozy, doctype, fields)\n    } else {\n      return defineIndexV3(cozy, doctype, fields)\n    }\n  })\n}\n\nexport function query(cozy, indexRef, options) {\n  return cozy.isV2().then(isV2 => {\n    if (!indexRef) {\n      throw new Error('query should be passed the indexRef')\n    }\n    if (isV2) {\n      return queryV2(cozy, indexRef, options)\n    } else {\n      return queryV3(cozy, indexRef, options)\n    }\n  })\n}\n\nexport function queryFiles(cozy, indexRef, options) {\n  const opts = getV3Options(indexRef, options)\n  return cozyFetchRawJSON(cozy, 'POST', '/files/_find', opts).then(\n    response => (options.wholeResponse ? response : response.docs)\n  )\n}\n\n// Internals\n\nconst VALUEOPERATORS = ['$eq', '$gt', '$gte', '$lt', '$lte']\nconst LOGICOPERATORS = ['$or', '$and', '$not']\n\n/* eslint-disable */\nconst MAP_TEMPLATE = function(doc) {\n  if (doc.docType.toLowerCase() === 'DOCTYPEPLACEHOLDER') {\n    emit(FIELDSPLACEHOLDER, doc)\n  }\n}\n  .toString()\n  .replace(/ /g, '')\n  .replace(/\\n/g, '')\nconst COUCHDB_INFINITY = { '\\uFFFF': '\\uFFFF' }\nconst COUCHDB_LOWEST = null\n/* eslint-enable */\n\n// defineIndexV2 is equivalent to defineIndex but only works for V2.\n// It transforms the index fields into a map reduce view.\nfunction defineIndexV2(cozy, doctype, fields) {\n  let indexName = 'by' + fields.map(capitalize).join('')\n  let indexDefinition = {\n    map: makeMapFunction(doctype, fields),\n    reduce: '_count'\n  }\n  let path = `/request/${doctype}/${indexName}/`\n  return cozyFetchJSON(cozy, 'PUT', path, indexDefinition).then(() => ({\n    doctype: doctype,\n    type: 'mapreduce',\n    name: indexName,\n    fields: fields\n  }))\n}\n\nfunction defineIndexV3(cozy, doctype, fields) {\n  let path = createPath(cozy, false, doctype, '_index')\n  let indexDefinition = { index: { fields } }\n  return cozyFetchJSON(cozy, 'POST', path, indexDefinition).then(response => {\n    const indexResult = {\n      doctype: doctype,\n      type: 'mango',\n      name: response.id,\n      fields\n    }\n\n    if (response.result === 'exists') return indexResult\n\n    // indexes might not be usable right after being created; so we delay the resolving until they are\n    const selector = {}\n    selector[fields[0]] = { $gt: null }\n\n    const opts = getV3Options(indexResult, { selector: selector })\n    let path = createPath(cozy, false, indexResult.doctype, '_find')\n    return cozyFetchJSON(cozy, 'POST', path, opts)\n      .then(() => indexResult)\n      .catch(() => {\n        // one retry\n        return sleep(1000)\n          .then(() => cozyFetchJSON(cozy, 'POST', path, opts))\n          .then(() => indexResult)\n          .catch(() => {\n            return sleep(500).then(() => indexResult)\n          })\n      })\n  })\n}\n\n// queryV2 is equivalent to query but only works for V2.\n// It transforms the query into a _views call using makeMapReduceQuery\nfunction queryV2(cozy, indexRef, options) {\n  if (indexRef.type !== 'mapreduce') {\n    throw new Error(\n      'query indexRef should be the return value of defineIndexV2'\n    )\n  }\n  if (options.fields) {\n    warn('query fields will be ignored on v2')\n  }\n\n  let path = `/request/${indexRef.doctype}/${indexRef.name}/`\n  let opts = makeMapReduceQuery(indexRef, options)\n  return cozyFetchJSON(cozy, 'POST', path, opts).then(response =>\n    response.map(r => r.value)\n  )\n}\n\n// queryV3 is equivalent to query but only works for V3\nfunction queryV3(cozy, indexRef, options) {\n  const opts = getV3Options(indexRef, options)\n\n  let path = createPath(cozy, false, indexRef.doctype, '_find')\n  return cozyFetchJSON(cozy, 'POST', path, opts).then(\n    response => (options.wholeResponse ? response : response.docs)\n  )\n}\n\nfunction getV3Options(indexRef, options) {\n  if (indexRef.type !== 'mango') {\n    throw new Error('indexRef should be the return value of defineIndexV3')\n  }\n\n  let opts = {\n    use_index: indexRef.name,\n    fields: options.fields,\n    selector: options.selector,\n    limit: options.limit,\n    skip: options.skip,\n    since: options.since,\n    sort: options.sort\n  }\n\n  if (options.descending) {\n    opts.sort = indexRef.fields.map(f => ({ [f]: 'desc' }))\n  }\n\n  return opts\n}\n\n// misc\nfunction capitalize(name) {\n  return name.charAt(0).toUpperCase() + name.slice(1)\n}\n\nfunction makeMapFunction(doctype, fields) {\n  fields = '[' + fields.map(name => 'doc.' + name).join(',') + ']'\n\n  return MAP_TEMPLATE.replace(\n    'DOCTYPEPLACEHOLDER',\n    doctype.toLowerCase()\n  ).replace('FIELDSPLACEHOLDER', fields)\n}\n\n// parseSelector takes a mango selector and returns it as an array of filter\n// a filter is [path, operator, value] array\n// a path is an array of field names\n// This function is only exported so it can be unit tested.\n// Example :\n// parseSelector({\"test\":{\"deep\": {\"$gt\": 3}}})\n// [[['test', 'deep'], '$gt', 3 ]]\nexport function parseSelector(selector, path = [], operator = '$eq') {\n  if (typeof selector !== 'object') {\n    return [[path, operator, selector]]\n  }\n\n  let keys = Object.keys(selector)\n  if (keys.length === 0) {\n    throw new Error('empty selector')\n  } else {\n    return keys.reduce(function(acc, k) {\n      if (LOGICOPERATORS.indexOf(k) !== -1) {\n        throw new Error('cozy-client-js does not support mango logic ops')\n      } else if (VALUEOPERATORS.indexOf(k) !== -1) {\n        return acc.concat(parseSelector(selector[k], path, k))\n      } else {\n        return acc.concat(parseSelector(selector[k], path.concat(k), '$eq'))\n      }\n    }, [])\n  }\n}\n\n// normalizeSelector takes a mango selector and returns it as an object\n// normalized.\n// This function is only exported so it can be unit tested.\n// Example :\n// parseSelector({\"test\":{\"deep\": {\"$gt\": 3}}})\n// {\"test.deep\": {\"$gt\": 3}}\nexport function normalizeSelector(selector) {\n  var filters = parseSelector(selector)\n  return filters.reduce(function(acc, filter) {\n    let [path, op, value] = filter\n    let field = path.join('.')\n    acc[field] = acc[field] || {}\n    acc[field][op] = value\n    return acc\n  }, {})\n}\n\n// applySelector takes the normalized selector for the current field\n// and append the proper values to opts.startkey, opts.endkey\nfunction applySelector(selector, opts) {\n  let value = selector['$eq']\n  let lower = COUCHDB_LOWEST\n  let upper = COUCHDB_INFINITY\n  let inclusiveEnd\n\n  if (value) {\n    opts.startkey.push(value)\n    opts.endkey.push(value)\n    return false\n  }\n\n  value = selector['$gt']\n  if (value) {\n    throw new Error('operator $gt (strict greater than) not supported')\n  }\n\n  value = selector['$gte']\n  if (value) {\n    lower = value\n  }\n\n  value = selector['$lte']\n  if (value) {\n    upper = value\n    inclusiveEnd = true\n  }\n\n  value = selector['$lt']\n  if (value) {\n    upper = value\n    inclusiveEnd = false\n  }\n\n  opts.startkey.push(lower)\n  opts.endkey.push(upper)\n  if (inclusiveEnd !== undefined) opts.inclusive_end = inclusiveEnd\n  return true\n}\n\n// makeMapReduceQuery takes a mango query and generate _views call parameters\n// to obtain same results depending on fields in the passed indexRef.\nexport function makeMapReduceQuery(indexRef, query) {\n  let mrquery = {\n    startkey: [],\n    endkey: [],\n    reduce: false\n  }\n  let firstFreeValueField = null\n  let normalizedSelector = normalizeSelector(query.selector)\n\n  indexRef.fields.forEach(function(field) {\n    let selector = normalizedSelector[field]\n\n    if (selector && firstFreeValueField != null) {\n      throw new Error(\n        'Selector on field ' +\n          field +\n          ', but not on ' +\n          firstFreeValueField +\n          ' which is higher in index fields.'\n      )\n    } else if (selector) {\n      selector.used = true\n      let isFreeValue = applySelector(selector, mrquery)\n      if (isFreeValue) firstFreeValueField = field\n    } else if (firstFreeValueField == null) {\n      firstFreeValueField = field\n      mrquery.endkey.push(COUCHDB_INFINITY)\n    }\n  })\n\n  Object.keys(normalizedSelector).forEach(function(field) {\n    if (!normalizedSelector[field].used) {\n      throw new Error(\n        'Cant apply selector on ' + field + ', it is not in index'\n      )\n    }\n  })\n\n  if (query.descending) {\n    mrquery = {\n      descending: true,\n      reduce: false,\n      startkey: mrquery.endkey,\n      endkey: mrquery.startkey,\n      inclusive_end: mrquery.inclusive_end\n    }\n  }\n\n  return mrquery\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/mango.js","/* global Blob, File */\nimport { cozyFetch, cozyFetchJSON } from './fetch'\nimport jsonapi from './jsonapi'\nimport { DOCTYPE_FILES } from './doctypes'\n\n// global variables\nexport const ROOT_DIR_ID = 'io.cozy.files.root-dir'\nexport const TRASH_DIR_ID = 'io.cozy.files.trash-dir'\n\nconst contentTypeOctetStream = 'application/octet-stream'\n\nfunction sanitizeFileName(name) {\n  return name && name.trim()\n}\n\nfunction getFileTypeFromName(name) {\n  if (/\\.heic$/i.test(name)) return 'image/heic'\n  else if (/\\.heif$/i.test(name)) return 'image/heif'\n  else return null\n}\n\nasync function doUpload(cozy, data, method, path, options) {\n  if (!data) {\n    throw new Error('missing data argument')\n  }\n\n  // transform any ArrayBufferView to ArrayBuffer\n  if (data.buffer && data.buffer instanceof ArrayBuffer) {\n    data = data.buffer\n  }\n\n  const isBuffer =\n    typeof ArrayBuffer !== 'undefined' && data instanceof ArrayBuffer\n  const isFile = typeof File !== 'undefined' && data instanceof File\n  const isBlob = typeof Blob !== 'undefined' && data instanceof Blob\n  const isStream = data.readable === true && typeof data.pipe === 'function'\n  const isString = typeof data === 'string'\n\n  if (!isBuffer && !isFile && !isBlob && !isStream && !isString) {\n    throw new Error('invalid data type')\n  }\n\n  let {\n    contentType,\n    contentLength,\n    checksum,\n    lastModifiedDate,\n    ifMatch,\n    metadata,\n    sourceAccount,\n    sourceAccountIdentifier\n  } = options || {}\n  if (!contentType) {\n    if (isBuffer) {\n      contentType = contentTypeOctetStream\n    } else if (isFile) {\n      contentType =\n        data.type ||\n        getFileTypeFromName(data.name.toLowerCase()) ||\n        contentTypeOctetStream\n      if (!lastModifiedDate) {\n        lastModifiedDate = data.lastModifiedDate\n      }\n    } else if (isBlob) {\n      contentType = data.type || contentTypeOctetStream\n    } else if (isStream) {\n      contentType = contentTypeOctetStream\n    } else if (typeof data === 'string') {\n      contentType = 'text/plain'\n    }\n  }\n\n  if (lastModifiedDate && typeof lastModifiedDate === 'string') {\n    lastModifiedDate = new Date(lastModifiedDate)\n  }\n\n  const headers = {\n    'Content-Type': contentType\n  }\n  if (contentLength) headers['Content-Length'] = String(contentLength)\n  if (checksum) headers['Content-MD5'] = checksum\n  if (lastModifiedDate) headers['Date'] = lastModifiedDate.toGMTString()\n  if (ifMatch) headers['If-Match'] = ifMatch\n\n  let finalpath = path\n  if (metadata) {\n    const metadataId = await sendMetadata(cozy, metadata)\n    if (metadataId) {\n      finalpath = addQuerystringParam(finalpath, 'MetadataID', metadataId)\n    }\n  }\n\n  if (sourceAccount) {\n    finalpath = addQuerystringParam(finalpath, 'SourceAccount', sourceAccount)\n  }\n\n  if (sourceAccountIdentifier) {\n    finalpath = addQuerystringParam(\n      finalpath,\n      'SourceAccountIdentifier',\n      sourceAccountIdentifier\n    )\n  }\n\n  return cozyFetch(cozy, finalpath, {\n    method: method,\n    headers: headers,\n    body: data\n  }).then(res => {\n    const json = res.json()\n    if (!res.ok) {\n      return json.then(err => {\n        throw err\n      })\n    } else {\n      return json.then(jsonapi)\n    }\n  })\n}\n\nasync function sendMetadata(cozy, metadata) {\n  const result = await cozyFetchJSON(cozy, 'POST', '/files/upload/metadata', {\n    data: { type: 'io.cozy.files.metadata', attributes: metadata }\n  })\n  return result && result._id ? result._id : false\n}\n\nexport function create(cozy, data, options) {\n  let { name, dirID, executable, noSanitize } = options || {}\n\n  // handle case where data is a file and contains the name\n  if (!name && typeof data.name === 'string') {\n    name = data.name\n  }\n\n  if (!noSanitize) {\n    name = sanitizeFileName(name)\n  }\n\n  if (typeof name !== 'string' || name === '') {\n    throw new Error('missing name argument')\n  }\n\n  if (executable === undefined) {\n    executable = false\n  }\n\n  const path = `/files/${encodeURIComponent(dirID || '')}`\n  const query = `?Name=${encodeURIComponent(\n    name\n  )}&Type=file&Executable=${executable}`\n  return doUpload(cozy, data, 'POST', `${path}${query}`, options)\n}\n\nexport function createDirectory(cozy, options) {\n  let { name, dirID, lastModifiedDate } = options || {}\n\n  name = sanitizeFileName(name)\n\n  if (typeof name !== 'string' || name === '') {\n    throw new Error('missing name argument')\n  }\n\n  if (lastModifiedDate && typeof lastModifiedDate === 'string') {\n    lastModifiedDate = new Date(lastModifiedDate)\n  }\n\n  const path = `/files/${encodeURIComponent(dirID || '')}`\n  const query = `?Name=${encodeURIComponent(name)}&Type=directory`\n  return cozyFetchJSON(cozy, 'POST', `${path}${query}`, undefined, {\n    headers: {\n      Date: lastModifiedDate ? lastModifiedDate.toGMTString() : ''\n    }\n  })\n}\n\nfunction getDirectoryOrCreate(cozy, name, parentDirectory) {\n  if (parentDirectory && !parentDirectory.attributes)\n    throw new Error('Malformed parent directory')\n\n  name = sanitizeFileName(name)\n\n  const path = `${\n    parentDirectory._id === ROOT_DIR_ID ? '' : parentDirectory.attributes.path\n  }/${name}`\n\n  return cozy.files.statByPath(path || '/').catch(error => {\n    const parsedError = JSON.parse(error.message)\n    const errors = parsedError.errors\n    if (errors && errors.length && errors[0].status === '404') {\n      return cozy.files.createDirectory({\n        name: name,\n        dirID: parentDirectory && parentDirectory._id\n      })\n    }\n\n    throw errors\n  })\n}\n\nexport function createDirectoryByPath(cozy, path, offline) {\n  const parts = path.split('/').filter(part => part !== '')\n\n  const rootDirectoryPromise = cozy.files.statById(ROOT_DIR_ID, offline)\n\n  return parts.length\n    ? parts.reduce((parentDirectoryPromise, part) => {\n        return parentDirectoryPromise.then(parentDirectory =>\n          getDirectoryOrCreate(cozy, part, parentDirectory)\n        )\n      }, rootDirectoryPromise)\n    : rootDirectoryPromise\n}\n\nexport function updateById(cozy, id, data, options) {\n  return doUpload(\n    cozy,\n    data,\n    'PUT',\n    `/files/${encodeURIComponent(id)}`,\n    options\n  )\n}\n\nfunction doUpdateAttributes(cozy, attrs, path, options) {\n  if (!attrs || typeof attrs !== 'object') {\n    throw new Error('missing attrs argument')\n  }\n\n  const { ifMatch } = options || {}\n  const body = {\n    data: {\n      attributes: Object.assign({}, attrs, {\n        name: sanitizeFileName(attrs.name)\n      })\n    }\n  }\n  return cozyFetchJSON(cozy, 'PATCH', path, body, {\n    headers: {\n      'If-Match': ifMatch || ''\n    }\n  })\n}\n\nexport function updateAttributesById(cozy, id, attrs, options) {\n  return doUpdateAttributes(\n    cozy,\n    attrs,\n    `/files/${encodeURIComponent(id)}`,\n    options\n  )\n}\n\nexport function updateAttributesByPath(cozy, path, attrs, options) {\n  return doUpdateAttributes(\n    cozy,\n    attrs,\n    `/files/metadata?Path=${encodeURIComponent(path)}`,\n    options\n  )\n}\n\nexport function trashById(cozy, id, options) {\n  if (typeof id !== 'string' || id === '') {\n    throw new Error('missing id argument')\n  }\n  const { ifMatch } = options || {}\n  return cozyFetchJSON(\n    cozy,\n    'DELETE',\n    `/files/${encodeURIComponent(id)}`,\n    undefined,\n    {\n      headers: {\n        'If-Match': ifMatch || ''\n      }\n    }\n  )\n}\n\nexport function statById(cozy, id, offline = true, options = {}) {\n  if (offline && cozy.offline.hasDatabase(DOCTYPE_FILES)) {\n    let db = cozy.offline.getDatabase(DOCTYPE_FILES)\n    return Promise.all([\n      db.get(id),\n      db.find(Object.assign({ selector: { dir_id: id } }, options))\n    ]).then(([doc, children]) => {\n      if (id === ROOT_DIR_ID) {\n        children.docs = children.docs.filter(doc => doc._id !== TRASH_DIR_ID)\n      }\n      children = sortFiles(\n        children.docs.map(doc => addIsDir(toJsonApi(cozy, doc)))\n      )\n      return addIsDir(toJsonApi(cozy, doc, children))\n    })\n  }\n  const query =\n    Object.keys(options).length === 0 ? '' : `?${encodePageOptions(options)}`\n  return cozyFetchJSON(\n    cozy,\n    'GET',\n    `/files/${encodeURIComponent(id)}${query}`\n  ).then(addIsDir)\n}\n\nexport function statByPath(cozy, path) {\n  return cozyFetchJSON(\n    cozy,\n    'GET',\n    `/files/metadata?Path=${encodeURIComponent(path)}`\n  ).then(addIsDir)\n}\n\nexport function downloadById(cozy, id) {\n  return cozyFetch(cozy, `/files/download/${encodeURIComponent(id)}`)\n}\n\nexport function downloadByPath(cozy, path) {\n  return cozyFetch(cozy, `/files/download?Path=${encodeURIComponent(path)}`)\n}\n\nfunction extractResponseLinkRelated(res) {\n  let href = res.links && res.links.related\n  if (!href) throw new Error('No related link in server response')\n  return href\n}\n\nexport function getDownloadLinkByPath(cozy, path) {\n  return cozyFetchJSON(\n    cozy,\n    'POST',\n    `/files/downloads?Path=${encodeURIComponent(path)}`\n  ).then(extractResponseLinkRelated)\n}\n\nexport function getDownloadLinkById(cozy, id) {\n  return cozyFetchJSON(\n    cozy,\n    'POST',\n    `/files/downloads?Id=${encodeURIComponent(id)}`\n  ).then(extractResponseLinkRelated)\n}\n\nexport function getFilePath(cozy, file = {}, folder) {\n  if (!folder || !folder.attributes) {\n    throw Error('Folder should be valid with an attributes.path property')\n  }\n\n  const folderPath = folder.attributes.path.endsWith('/')\n    ? folder.attributes.path\n    : `${folder.attributes.path}/`\n\n  return `${folderPath}${file.name}`\n}\n\nexport function getCollectionShareLink(cozy, id, collectionType) {\n  if (!id) {\n    return Promise.reject(\n      Error('An id should be provided to create a share link')\n    )\n  }\n  return cozyFetchJSON(cozy, 'POST', `/permissions?codes=email`, {\n    data: {\n      type: 'io.cozy.permissions',\n      attributes: {\n        permissions: {\n          files: {\n            type: 'io.cozy.files',\n            verbs: ['GET'],\n            values: [id],\n            selector: 'referenced_by'\n          },\n          collection: {\n            type: collectionType,\n            verbs: ['GET'],\n            values: [id]\n          }\n        }\n      }\n    }\n  }).then(data => ({\n    sharecode: `sharecode=${data.attributes.codes.email}`,\n    id: `id=${id}`\n  }))\n}\n\nexport function getArchiveLinkByPaths(cozy, paths, name = 'files') {\n  const archive = {\n    type: 'io.cozy.archives',\n    attributes: {\n      name: name,\n      files: paths\n    }\n  }\n  return cozyFetchJSON(cozy, 'POST', `/files/archive`, { data: archive }).then(\n    extractResponseLinkRelated\n  )\n}\n\nexport function getArchiveLinkByIds(cozy, ids, name = 'files') {\n  const archive = {\n    type: 'io.cozy.archives',\n    attributes: {\n      name: name,\n      ids: ids\n    }\n  }\n  return cozyFetchJSON(cozy, 'POST', `/files/archive`, { data: archive }).then(\n    extractResponseLinkRelated\n  )\n}\n\nexport function listTrash(cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/files/trash`)\n}\n\nexport function clearTrash(cozy) {\n  return cozyFetchJSON(cozy, 'DELETE', `/files/trash`)\n}\n\nexport function restoreById(cozy, id) {\n  return cozyFetchJSON(cozy, 'POST', `/files/trash/${encodeURIComponent(id)}`)\n}\n\nexport function destroyById(cozy, id, options) {\n  const { ifMatch } = options || {}\n  return cozyFetchJSON(\n    cozy,\n    'DELETE',\n    `/files/trash/${encodeURIComponent(id)}`,\n    undefined,\n    {\n      headers: {\n        'If-Match': ifMatch || ''\n      }\n    }\n  )\n}\n\nfunction addIsDir(obj) {\n  obj.isDir = obj.attributes.type === 'directory'\n  return obj\n}\n\nfunction encodePageOptions(options) {\n  let opts = []\n  for (const name in options) {\n    opts.push(\n      `page[${encodeURIComponent(name)}]=${encodeURIComponent(options[name])}`\n    )\n  }\n  return opts.join('&')\n}\n\nfunction toJsonApi(cozy, doc, contents = []) {\n  let clone = JSON.parse(JSON.stringify(doc))\n  delete clone._id\n  delete clone._rev\n  return {\n    _id: doc._id,\n    _rev: doc._rev,\n    _type: DOCTYPE_FILES,\n    attributes: clone,\n    relationships: {\n      contents: {\n        data: contents,\n        meta: {\n          count: contents.length\n        }\n      }\n    },\n    relations: name => {\n      if (name === 'contents') {\n        return contents\n      }\n    }\n  }\n}\n\nfunction sortFiles(allFiles) {\n  const folders = allFiles.filter(f => f.attributes.type === 'directory')\n  const files = allFiles.filter(f => f.attributes.type !== 'directory')\n  const sort = files =>\n    files.sort((a, b) => a.attributes.name.localeCompare(b.attributes.name))\n  return sort(folders).concat(sort(files))\n}\n\nfunction addQuerystringParam(path, key, value) {\n  return `${path}${path.includes('?') ? '&' : '?'}${key}=${value}`\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/files.js","import { errorSerializer, pickService } from './helpers'\nimport { create as createIntent } from './'\n\nconst intentClass = 'coz-intent'\n\nfunction hideIntentIframe(iframe) {\n  iframe.style.display = 'none'\n}\n\nfunction showIntentFrame(iframe) {\n  iframe.style.display = 'block'\n}\n\nfunction buildIntentIframe(intent, element, url) {\n  const document = element.ownerDocument\n  if (!document)\n    return Promise.reject(\n      new Error('Cannot retrieve document object from given element')\n    )\n\n  const iframe = document.createElement('iframe')\n  // TODO: implement 'title' attribute\n  iframe.setAttribute('id', `intent-${intent._id}`)\n  iframe.setAttribute('src', url)\n  iframe.classList.add(intentClass)\n  return iframe\n}\n\nfunction injectIntentIframe(intent, element, url, options) {\n  const { onReadyCallback } = options\n  const iframe = buildIntentIframe(\n    intent,\n    element,\n    url,\n    options.onReadyCallback\n  )\n  // if callback provided for when iframe is loaded\n  if (typeof onReadyCallback === 'function') iframe.onload = onReadyCallback\n  element.appendChild(iframe)\n  iframe.focus()\n  return iframe\n}\n\n// inject iframe for service in given element\nfunction connectIntentIframe(cozy, iframe, element, intent, data) {\n  const document = element.ownerDocument\n  if (!document)\n    return Promise.reject(\n      new Error('Cannot retrieve document object from given element')\n    )\n\n  const window = document.defaultView\n  if (!window)\n    return Promise.reject(\n      new Error('Cannot retrieve window object from document')\n    )\n\n  // Keeps only http://domain:port/\n  const serviceOrigin = iframe.src.split('/', 3).join('/')\n\n  async function compose(cozy, action, doctype, data) {\n    const intent = await createIntent(cozy, action, doctype, data)\n    hideIntentIframe(iframe)\n    const doc = await start(cozy, intent, element, {\n      ...data,\n      exposeIntentFrameRemoval: false\n    })\n    showIntentFrame(iframe)\n    return doc\n  }\n\n  return new Promise((resolve, reject) => {\n    let handshaken = false\n    const messageHandler = async event => {\n      if (event.origin !== serviceOrigin) return\n\n      const eventType = event.data.type\n      if (eventType === 'load') {\n        // Safari 9.1 (At least) send a MessageEvent when the iframe loads,\n        // making the handshake fails.\n        console.warn &&\n          console.warn(\n            'Cozy Client ignored MessageEvent having data.type `load`.'\n          )\n        return\n      }\n\n      if (eventType === `intent-${intent._id}:ready`) {\n        handshaken = true\n        return event.source.postMessage(data, event.origin)\n      }\n\n      if (handshaken && eventType === `intent-${intent._id}:resize`) {\n        ;['width', 'height', 'maxWidth', 'maxHeight'].forEach(prop => {\n          if (event.data.transition)\n            element.style.transition = event.data.transition\n          if (event.data.dimensions[prop])\n            element.style[prop] = `${event.data.dimensions[prop]}px`\n        })\n\n        return true\n      }\n\n      if (handshaken && eventType === `intent-${intent._id}:compose`) {\n        // Let start to name `type` as `doctype`, as `event.data` already have a `type` attribute.\n        const { action, doctype, data } = event.data\n        const doc = await compose(\n          cozy,\n          action,\n          doctype,\n          data\n        )\n        return event.source.postMessage(doc, event.origin)\n      }\n\n      window.removeEventListener('message', messageHandler)\n      const removeIntentFrame = () => {\n        // check if the parent node has not been already removed from the DOM\n        iframe.parentNode && iframe.parentNode.removeChild(iframe)\n      }\n\n      if (\n        handshaken &&\n        eventType === `intent-${intent._id}:exposeFrameRemoval`\n      ) {\n        return resolve({ removeIntentFrame, doc: event.data.document })\n      }\n\n      removeIntentFrame()\n\n      if (eventType === `intent-${intent._id}:error`) {\n        return reject(errorSerializer.deserialize(event.data.error))\n      }\n\n      if (handshaken && eventType === `intent-${intent._id}:cancel`) {\n        return resolve(null)\n      }\n\n      if (handshaken && eventType === `intent-${intent._id}:done`) {\n        return resolve(event.data.document)\n      }\n\n      if (!handshaken) {\n        return reject(\n          new Error('Unexpected handshake message from intent service')\n        )\n      }\n\n      // We may be in a state where the messageHandler is still attached to then\n      // window, but will not be needed anymore. For example, the service failed\n      // before adding the `unload` listener, so no `intent:cancel` message has\n      // never been sent.\n      // So we simply ignore other messages, and this listener will stay here,\n      // waiting for a message which will never come, forever (almost).\n    }\n\n    window.addEventListener('message', messageHandler)\n  })\n}\n\nexport function start(cozy, intent, element, data = {}, options = {}) {\n  const service = pickService(intent, options.filterServices)\n\n  if (!service) {\n    throw new Error('Unable to find a service')\n  }\n\n  const iframe = injectIntentIframe(intent, element, service.href, options)\n\n  return connectIntentIframe(\n    cozy,\n    iframe,\n    element,\n    intent,\n    data,\n    options.onReadyCallback\n  )\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/intents/client.js","import { cozyFetchJSON } from '../fetch'\nimport { errorSerializer } from './helpers'\n\nfunction listenClientData(intent, window) {\n  return new Promise(resolve => {\n    const messageEventListener = event => {\n      if (event.origin !== intent.attributes.client) return\n\n      window.removeEventListener('message', messageEventListener)\n      resolve(event.data)\n    }\n\n    window.addEventListener('message', messageEventListener)\n    window.parent.postMessage(\n      {\n        type: `intent-${intent._id}:ready`\n      },\n      intent.attributes.client\n    )\n  })\n}\n\n// maximize the height of an element\nfunction maximize(element) {\n  if (element && element.style) {\n    element.style.height = '100%'\n  }\n}\n\nexport function start(cozy, intentId, serviceWindow) {\n  serviceWindow = serviceWindow || (typeof window !== 'undefined' && window)\n  if (!serviceWindow || !serviceWindow.document) {\n    return Promise.reject(new Error('Intent service should be used in browser'))\n  }\n\n  // Maximize document, the whole iframe is handled by intents, clients and\n  // services\n  serviceWindow.addEventListener('load', () => {\n    const { document } = serviceWindow\n    ;[document.documentElement, document.body].forEach(maximize)\n  })\n\n  intentId = intentId || serviceWindow.location.search.split('=')[1]\n  if (!intentId)\n    return Promise.reject(new Error('Cannot retrieve intent from URL'))\n\n  return cozyFetchJSON(cozy, 'GET', `/intents/${intentId}`).then(intent => {\n    let terminated = false\n\n    const sendMessage = message => {\n      if (terminated)\n        throw new Error('Intent service has already been terminated')\n      serviceWindow.parent.postMessage(message, intent.attributes.client)\n    }\n\n    const compose = (action, doctype, data) =>\n      new Promise(resolve => {\n        const composeEventListener = event => {\n          if (event.origin !== intent.attributes.client) return\n          serviceWindow.removeEventListener('message', composeEventListener)\n          return resolve(event.data)\n        }\n\n        serviceWindow.addEventListener('message', composeEventListener)\n\n        sendMessage({\n          type: `intent-${intent._id}:compose`,\n          action,\n          doctype,\n          data\n        })\n      })\n\n    const terminate = message => {\n      sendMessage(message)\n      terminated = true\n    }\n\n    const resizeClient = (dimensions, transitionProperty) => {\n      if (terminated) throw new Error('Intent service has been terminated')\n\n      sendMessage({\n        type: `intent-${intent._id}:resize`,\n        // if a dom element is passed, calculate its size\n        dimensions: dimensions.element\n          ? Object.assign({}, dimensions, {\n              maxHeight: dimensions.element.clientHeight,\n              maxWidth: dimensions.element.clientWidth\n            })\n          : dimensions,\n        transition: transitionProperty\n      })\n    }\n\n    const cancel = () => {\n      terminate({ type: `intent-${intent._id}:cancel` })\n    }\n\n    // Prevent unfulfilled client promises when this window unloads for a\n    // reason or another.\n    serviceWindow.addEventListener('unload', () => {\n      if (!terminated) cancel()\n    })\n\n    return listenClientData(intent, serviceWindow).then(data => {\n      return {\n        compose: compose,\n        getData: () => data,\n        getIntent: () => intent,\n        terminate: doc => {\n          const eventName =\n            data && data.exposeIntentFrameRemoval\n              ? 'exposeFrameRemoval'\n              : 'done'\n          return terminate({\n            type: `intent-${intent._id}:${eventName}`,\n            document: doc\n          })\n        },\n        throw: error =>\n          terminate({\n            type: `intent-${intent._id}:error`,\n            error: errorSerializer.serialize(error)\n          }),\n        resizeClient: resizeClient,\n        cancel: cancel\n      }\n    })\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/intents/service.js","import { cozyFetchJSON } from './fetch'\n\nexport function count(cozy, workerType) {\n  return cozyFetchJSON(cozy, 'GET', `/jobs/queue/${workerType}`).then(\n    data => data.length\n  )\n}\n\nexport function queued(cozy, workerType) {\n  return cozyFetchJSON(cozy, 'GET', `/jobs/queue/${workerType}`)\n}\n\nexport function create(cozy, workerType, args, options) {\n  return cozyFetchJSON(cozy, 'POST', `/jobs/queue/${workerType}`, {\n    data: {\n      type: 'io.cozy.jobs',\n      attributes: {\n        arguments: args || {},\n        options: options || {}\n      }\n    }\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jobs.js","import { DOCTYPE_FILES } from './doctypes'\nimport { refreshToken } from './auth_v3'\nimport { isOffline } from './utils'\nimport PouchDB from 'pouchdb-browser'\nimport pouchdbFind from 'pouchdb-find'\n\nexport const replicationOfflineError =\n  'Replication abort, your device is actually offline.'\n\nlet pluginLoaded = false\n\n/*\n  For each doctype we have some parameters:\n  cozy._offline[doctype] = {\n    database: pouchdb database\n    replication: the pouchdb replication\n    replicationPromise: promise of replication\n    interval: repeated replication interval\n  }\n*/\n\nexport function init(cozy, { options = {}, doctypes = [] }) {\n  for (let doctype of doctypes) {\n    createDatabase(cozy, doctype, options)\n  }\n}\n\n// helper\n\nfunction getInfo(cozy, doctype) {\n  cozy._offline = cozy._offline || []\n  cozy._offline[doctype] = cozy._offline[doctype] || {}\n  return cozy._offline[doctype]\n}\n\nexport function getDoctypes(cozy) {\n  cozy._offline = cozy._offline || []\n  return Object.keys(cozy._offline)\n}\n\n//\n// DATABASE\n//\n\nexport function hasDatabase(cozy, doctype) {\n  return getDatabase(cozy, doctype) !== undefined\n}\n\nexport function getDatabase(cozy, doctype) {\n  return getInfo(cozy, doctype).database\n}\n\nexport function setDatabase(cozy, doctype, database) {\n  cozy._offline[doctype].database = database\n  return getDatabase(cozy, doctype)\n}\n\nexport function migrateDatabase(cozy, doctype, options = {}) {\n  const oldDb = getDatabase(cozy, doctype)\n  const newOptions = {\n    adapter: 'idb',\n    ...options\n  }\n  const newDb = new PouchDB(doctype, newOptions)\n\n  return oldDb.replicate.to(newDb).then(() => {\n    setDatabase(cozy, doctype, newDb)\n    oldDb.destroy()\n    return newDb\n  })\n}\n\nexport function createDatabase(cozy, doctype, options = {}) {\n  if (!pluginLoaded) {\n    PouchDB.plugin(pouchdbFind)\n    pluginLoaded = true\n  }\n\n  if (hasDatabase(cozy, doctype)) {\n    return Promise.resolve(getDatabase(cozy, doctype))\n  }\n\n  setDatabase(cozy, doctype, new PouchDB(doctype, options))\n  return createIndexes(cozy, doctype).then(() => getDatabase(cozy, doctype))\n}\n\nexport function destroyDatabase(cozy, doctype) {\n  if (!hasDatabase(cozy, doctype)) {\n    return Promise.resolve(false)\n  }\n\n  return stopRepeatedReplication(cozy, doctype)\n    .then(() => stopReplication(cozy, doctype))\n    .then(() => getDatabase(cozy, doctype).destroy())\n    .then(response => {\n      setDatabase(cozy, doctype, undefined)\n      return response\n    })\n}\n\nexport function destroyAllDatabase(cozy) {\n  const doctypes = getDoctypes(cozy)\n  const destroy = doctype => destroyDatabase(cozy, doctype)\n  return Promise.all(doctypes.map(destroy))\n}\n\nfunction createIndexes(cozy, doctype) {\n  if (doctype === DOCTYPE_FILES) {\n    return getDatabase(cozy, doctype).createIndex({\n      index: { fields: ['dir_id'] }\n    })\n  }\n  return Promise.resolve()\n}\n\n//\n// REPLICATION\n//\n\nexport function hasReplication(cozy, doctype) {\n  return getReplication(cozy, doctype) !== undefined\n}\n\nfunction getReplication(cozy, doctype) {\n  return getInfo(cozy, doctype).replication\n}\n\nfunction setReplication(cozy, doctype, replication) {\n  cozy._offline[doctype].replication = replication\n  return getReplication(cozy, doctype)\n}\n\nfunction getReplicationUrl(cozy, doctype) {\n  return cozy.authorize().then(credentials => {\n    const basic = credentials.token.toBasicAuth()\n    return (cozy._url + '/data/' + doctype).replace('//', `//${basic}`)\n  })\n}\n\nfunction getReplicationPromise(cozy, doctype) {\n  return getInfo(cozy, doctype).replicationPromise\n}\n\nfunction setReplicationPromise(cozy, doctype, promise) {\n  cozy._offline[doctype].replicationPromise = promise\n  return getReplicationPromise(cozy, doctype)\n}\n\nexport function replicateFromCozy(cozy, doctype, options = {}) {\n  return setReplicationPromise(\n    cozy,\n    doctype,\n    new Promise((resolve, reject) => {\n      if (!hasDatabase(cozy, doctype)) {\n        createDatabase(cozy, doctype)\n      }\n      if (options.live === true) {\n        return reject(\n          new Error(\"You can't use `live` option with Cozy couchdb.\")\n        )\n      }\n\n      if (isOffline()) {\n        reject(replicationOfflineError)\n        options.onError && options.onError(replicationOfflineError)\n        return\n      }\n\n      getReplicationUrl(cozy, doctype).then(url =>\n        setReplication(\n          cozy,\n          doctype,\n          getDatabase(cozy, doctype)\n            .replicate.from(url, options)\n            .on('complete', info => {\n              setReplication(cozy, doctype, undefined)\n              resolve(info)\n              options.onComplete && options.onComplete(info)\n            })\n            .on('error', err => {\n              if (err.error === 'code=400, message=Expired token') {\n                cozy.authorize().then(({ client, token }) => {\n                  refreshToken(cozy, client, token)\n                    .then(newToken => cozy.saveCredentials(client, newToken))\n                    .then(() => replicateFromCozy(cozy, doctype, options))\n                })\n              } else {\n                console.warn(`ReplicateFromCozy '${doctype}' Error:`)\n                console.warn(err)\n                setReplication(cozy, doctype, undefined)\n                reject(err)\n                options.onError && options.onError(err)\n              }\n            })\n        )\n      )\n    })\n  )\n}\n\nexport function stopReplication(cozy, doctype) {\n  if (!getDatabase(cozy, doctype) || !hasReplication(cozy, doctype)) {\n    return Promise.resolve()\n  }\n\n  return new Promise(resolve => {\n    try {\n      getReplicationPromise(cozy, doctype).then(() => {\n        resolve()\n      })\n      getReplication(cozy, doctype).cancel()\n      // replication is set to undefined by complete replication\n    } catch (e) {\n      resolve()\n    }\n  })\n}\n\nexport function stopAllReplication(cozy) {\n  const doctypes = getDoctypes(cozy)\n  const stop = doctype => stopReplication(cozy, doctype)\n  return Promise.all(doctypes.map(stop))\n}\n\n//\n// REPEATED REPLICATION\n//\n\nfunction getRepeatedReplication(cozy, doctype) {\n  return getInfo(cozy, doctype).interval\n}\n\nfunction setRepeatedReplication(cozy, doctype, interval) {\n  cozy._offline[doctype].interval = interval\n}\n\nexport function hasRepeatedReplication(cozy, doctype) {\n  return getRepeatedReplication(cozy, doctype) !== undefined\n}\n\nexport function startRepeatedReplication(cozy, doctype, timer, options = {}) {\n  // TODO: add timer limitation for not flooding Gozy\n  if (hasRepeatedReplication(cozy, doctype)) {\n    return getRepeatedReplication(cozy, doctype)\n  }\n\n  return setRepeatedReplication(\n    cozy,\n    doctype,\n    setInterval(() => {\n      if (isOffline()) {\n        // network is offline, replication cannot be launched\n        console.info(replicationOfflineError)\n        return\n      }\n      if (!hasReplication(cozy, doctype)) {\n        replicateFromCozy(cozy, doctype, options)\n        // TODO: add replicationToCozy\n      }\n    }, timer * 1000)\n  )\n}\n\nexport function stopRepeatedReplication(cozy, doctype) {\n  if (hasRepeatedReplication(cozy, doctype)) {\n    clearInterval(getRepeatedReplication(cozy, doctype))\n    setRepeatedReplication(cozy, doctype, undefined)\n  }\n  if (hasReplication(cozy, doctype)) {\n    return stopReplication(cozy, doctype)\n  }\n\n  return Promise.resolve()\n}\n\nexport function stopAllRepeatedReplication(cozy) {\n  const doctypes = getDoctypes(cozy)\n  const stop = doctype => stopRepeatedReplication(cozy, doctype)\n  return Promise.all(doctypes.map(stop))\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/offline.js","module.exports = require(\"pouchdb-browser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pouchdb-browser\"\n// module id = 22\n// module chunks = 0","module.exports = require(\"pouchdb-find\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pouchdb-find\"\n// module id = 23\n// module chunks = 0","import { cozyFetchJSON } from './fetch'\n\nexport function diskUsage(cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/settings/disk-usage`)\n}\n\nexport function changePassphrase(cozy, currentPassPhrase, newPassPhrase) {\n  return cozyFetchJSON(cozy, 'PUT', `/settings/passphrase`, {\n    current_passphrase: currentPassPhrase,\n    new_passphrase: newPassPhrase\n  })\n}\n\nexport function getInstance(cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/settings/instance`)\n}\n\nexport function updateInstance(cozy, instance) {\n  return cozyFetchJSON(cozy, 'PUT', `/settings/instance`, instance)\n}\n\nexport function getClients(cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/settings/clients`)\n}\n\nexport function deleteClientById(cozy, id) {\n  return cozyFetchJSON(cozy, 'DELETE', `/settings/clients/${id}`)\n}\n\nexport function updateLastSync(cozy) {\n  return cozyFetchJSON(cozy, 'POST', '/settings/synchronized')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/settings.js","import { cozyFetchJSON, cozyFetchRawJSON } from './fetch'\nimport { DOCTYPE_FILES } from './doctypes'\n\nfunction updateRelations(verb) {\n  return function(cozy, doc, ids) {\n    if (!doc) throw new Error('missing doc argument')\n    if (!Array.isArray(ids)) ids = [ids]\n\n    const refs = ids.map(id => ({ type: DOCTYPE_FILES, id }))\n\n    return cozyFetchJSON(cozy, verb, makeReferencesPath(doc), { data: refs })\n  }\n}\n\nexport const addReferencedFiles = updateRelations('POST')\nexport const removeReferencedFiles = updateRelations('DELETE')\n\nexport function listReferencedFiles(cozy, doc) {\n  if (!doc) throw new Error('missing doc argument')\n  return cozyFetchJSON(cozy, 'GET', makeReferencesPath(doc)).then(files =>\n    files.map(file => file._id)\n  )\n}\n\nexport function fetchReferencedFiles(cozy, doc, options, sort) {\n  if (!doc) throw new Error('missing doc argument')\n  const params = Object.keys(options)\n    .map(key => {\n      const value = encodeURIComponent(JSON.stringify(options[key]))\n      return `&page[${key}]=${value}`\n    })\n    .join('')\n  // Datetime is the default sort, but 'id' is also available\n  if (!sort) {\n    sort = 'datetime'\n  }\n  return cozyFetchRawJSON(\n    cozy,\n    'GET',\n    `${makeReferencesPath(doc)}?include=files&sort=${sort}${params}`\n  )\n}\n\nfunction makeReferencesPath(doc) {\n  const type = encodeURIComponent(doc._type)\n  const id = encodeURIComponent(doc._id)\n  return `/data/${type}/${id}/relationships/references`\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/relations.js"],"sourceRoot":""}